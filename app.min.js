!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=36)}([function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(21).Buffer,o=n(22),a=n(46),i=n(2)("express"),s=n(5),l=n(23).mime,u=n(47),c=n(24),m=n(20),f=n(48);function p(e){return function(t,n){var o=r.isBuffer(t)?t:r.from(t,n);return u(o,e)}}function d(e){return m.parse(e,{allowPrototypes:!0})}function h(){return{}}t.etag=p({weak:!1}),t.wetag=p({weak:!0}),t.isAbsolute=function(e){return"/"===e[0]||(":"===e[1]&&("\\"===e[2]||"/"===e[2])||("\\\\"===e.substring(0,2)||void 0))},t.flatten=i.function(s,"utils.flatten: use array-flatten npm module instead"),t.normalizeType=function(e){return~e.indexOf("/")?function(e,t){for(var n=e.split(/ *; */),r={value:n[0],quality:1,params:{},originalIndex:t},o=1;o<n.length;++o){var a=n[o].split(/ *= */);"q"===a[0]?r.quality=parseFloat(a[1]):r.params[a[0]]=a[1]}return r}(e):{value:l.lookup(e),params:{}}},t.normalizeTypes=function(e){for(var n=[],r=0;r<e.length;++r)n.push(t.normalizeType(e[r]));return n},t.contentDisposition=i.function(o,"utils.contentDisposition: use content-disposition npm module instead"),t.compileETag=function(e){var n;if("function"==typeof e)return e;switch(e){case!0:n=t.wetag;break;case!1:break;case"strong":n=t.etag;break;case"weak":n=t.wetag;break;default:throw new TypeError("unknown value for etag function: "+e)}return n},t.compileQueryParser=function(e){var t;if("function"==typeof e)return e;switch(e){case!0:t=f.parse;break;case!1:t=h;break;case"extended":t=d;break;case"simple":t=f.parse;break;default:throw new TypeError("unknown value for query parser function: "+e)}return t},t.compileTrust=function(e){return"function"==typeof e?e:!0===e?function(){return!0}:"number"==typeof e?function(t,n){return n<e}:("string"==typeof e&&(e=e.split(/ *, */)),c.compile(e||[]))},t.setCharset=function(e,t){if(!e||!t)return e;var n=a.parse(e);return n.parameters.charset=t,a.format(n)}},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("depd")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("array-flatten")},function(e,t){e.exports=require("utils-merge")},function(e,t){e.exports=require("methods")},function(e,t){e.exports=require("parseurl")},function(e,t){e.exports=require("setprototypeof")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("on-finished")},function(e,t){e.exports=require("express")},function(e,t,n){const r=n(97),o=n(98),a=n(35);function i(e){return new Promise((function(t,n){r.query(e,(function(e,n){e?(console.log("数据表获取失败: "+e.message),t({error:!0,message:e.message})):t(n)}))}))}function s(e){let t=[],n=[],r=[],s=[];a.metalColumn.fields.map(e=>{e.isKey||n.push(e.name)}),a.metalTabel.fields.map(e=>{e.isKey||t.push(e.name)});let l=t.join(","),u=[];u.push(`truncate table ${a.metalColumn.name} CASCADE `),u.push(`truncate table ${a.metalTabel.name} CASCADE `),e.map(e=>{let t=`insert into ${a.metalTabel.name}  (${l}) VALUES ('${e.tablename}','${e.comment}','id','${e.tablename}',1,'','${e.comment}')`;u.push(t)}),u=u.join(";"),u+=`;select * from ${a.metalTabel.name}; `;let c=i(u).then(e=>{s=e}),m=i(o.getColumnsDML()).then(e=>{r=e});return Promise.all([c,m]).then(e=>{let t=n.join(","),o=[],l=s.filter(e=>"SELECT"==e.command)[0];if(!l||l.rows<1)console.log("元数据表为空: ");else{if(r&&!(r.rows<1))return r.rows.map(e=>{let n=l.rows.filter(t=>t.tablename==e.tbname)[0],r="t"==e.notnull?1:0;n&&o.push(`insert into ${a.metalColumn.name} (${t}) VALUES (\n\t\t\t\t\t${n.id},\n\t\t\t\t\t'${e.name}',\n\t\t\t\t\t'${e.comment}',\n\t\t\t\t\t'${e.type}',\n\t\t\t\t\t 1,\n\t\t\t\t\t ${r},\n\t\t\t\t\t 1,\n\t\t\t\t\t 100,\n\t\t\t\t\t '${e.comment}'\n\t\n\t\t\t\t)`)}),i(o.join(";"));console.log("元数据表为空: ")}})}e.exports={updateDB:function(){try{return i(o.getTablesDML()).then(e=>{if(2==e.rows.filter(e=>e.tablename==a.metalTabel.name||e.tablename==a.metalColumn.name).length)return s(e.rows);(function(){let e=i(o.metalTableDDL()),t=i(o.metalColumnDDL());return Promise.all([e,t])})().then(t=>s(e.rows))})}catch(e){return null}},doQuery:i}},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(17),o=n(18),a=n(7),i=n(6),s=n(1)("express:router"),l=n(2)("express"),u=n(5),c=n(8),m=n(9),f=/^\[object (\S+)\]$/,p=Array.prototype.slice,d=Object.prototype.toString,h=e.exports=function(e){var t=e||{};function n(e,t,r){n.handle(e,t,r)}return m(n,h),n.params={},n._params=[],n.caseSensitive=t.caseSensitive,n.mergeParams=t.mergeParams,n.strict=t.strict,n.stack=[],n};function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}function g(e){var t=typeof e;return"object"!==t?t:d.call(e).replace(f,"$1")}function v(e,t){try{return e.match(t)}catch(e){return e}}h.param=function(e,t){if("function"==typeof e)return l("router.param(fn): Refactor to use path params"),void this._params.push(e);var n,r=this._params,o=r.length;":"===e[0]&&(l("router.param("+JSON.stringify(e)+", fn): Use router.param("+JSON.stringify(e.substr(1))+", fn) instead"),e=e.substr(1));for(var a=0;a<o;++a)(n=r[a](e,t))&&(t=n);if("function"!=typeof t)throw new Error("invalid param() call for "+e+", got "+t);return(this.params[e]=this.params[e]||[]).push(t),this},h.handle=function(e,t,n){var r=this;s("dispatching %s %s",e.method,e.url);var o=0,a=function(e){if("string"!=typeof e||0===e.length||"/"===e[0])return;var t=e.indexOf("?"),n=-1!==t?t:e.length,r=e.substr(0,n).indexOf("://");return-1!==r?e.substr(0,e.indexOf("/",3+r)):void 0}(e.url)||"",l="",u=!1,m={},f=[],p=r.stack,d=e.params,h=e.baseUrl||"",g=function(e,t){for(var n=new Array(arguments.length-2),r=new Array(arguments.length-2),o=0;o<n.length;o++)n[o]=arguments[o+2],r[o]=t[n[o]];return function(){for(var o=0;o<n.length;o++)t[n[o]]=r[o];return e.apply(this,arguments)}}(n,e,"baseUrl","next","params");function b(n){var w="route"===n?null:n;if(u&&(e.url=e.url.substr(1),u=!1),0!==l.length&&(e.baseUrl=h,e.url=a+l+e.url.substr(a.length),l=""),"router"!==w)if(o>=p.length)setImmediate(g,w);else{var x,_,E,k=function(e){try{return c(e).pathname}catch(e){return}}(e);if(null==k)return g(w);for(;!0!==_&&o<p.length;)if(_=v(x=p[o++],k),E=x.route,"boolean"!=typeof _&&(w=w||_),!0===_&&E)if(w)_=!1;else{var q=e.method,A=E._handles_method(q);A||"OPTIONS"!==q||y(f,E._options()),A||"HEAD"===q||(_=!1)}if(!0!==_)return g(w);E&&(e.route=E),e.params=r.mergeParams?function(e,t){if("object"!=typeof t||!t)return e;var n=i({},t);if(!(0 in e&&0 in t))return i(n,e);var r=0,o=0;for(;r in e;)r++;for(;o in t;)o++;for(r--;r>=0;r--)e[r+o]=e[r],r<o&&delete e[r];return i(n,e)}(x.params,d):x.params;var N=x.path;r.process_params(x,m,e,t,(function(n){return n?b(w||n):E?x.handle_request(e,t,b):void function(n,r,o,i){if(0!==o.length){var c=i[o.length];if(c&&"/"!==c&&"."!==c)return b(r);s("trim prefix (%s) from url %s",o,e.url),l=o,e.url=a+e.url.substr(a.length+l.length),a||"/"===e.url[0]||(e.url="/"+e.url,u=!0),e.baseUrl=h+("/"===l[l.length-1]?l.substring(0,l.length-1):l)}s("%s %s : %s",n.name,o,e.originalUrl),r?n.handle_error(r,e,t,b):n.handle_request(e,t,b)}(x,w,N,k)}))}else setImmediate(g,null)}e.next=b,"OPTIONS"===e.method&&(g=function(e,t){return function(){var n=new Array(arguments.length+1);n[0]=e;for(var r=0,o=arguments.length;r<o;r++)n[r+1]=arguments[r];t.apply(this,n)}}(g,(function(e,n){if(n||0===f.length)return e(n);!function(e,t,n){try{var r=t.join(",");e.set("Allow",r),e.send(r)}catch(e){n(e)}}(t,f,e)}))),e.baseUrl=h,e.originalUrl=e.originalUrl||e.url,b()},h.process_params=function(e,t,n,r,o){var a=this.params,i=e.keys;if(!i||0===i.length)return o();var s,l,u,c,m,f=0,p=0;function d(e){return e?o(e):f>=i.length?o():(p=0,l=i[f++],s=l.name,u=n.params[s],c=a[s],m=t[s],void 0!==u&&c?m&&(m.match===u||m.error&&"route"!==m.error)?(n.params[s]=m.value,d(m.error)):(t[s]=m={error:null,match:u,value:u},void h()):d())}function h(e){var t=c[p++];if(m.value=n.params[l.name],e)return m.error=e,void d(e);if(!t)return d();try{t(n,r,h,u,l.name)}catch(e){h(e)}}d()},h.use=function(e){var t=0,n="/";if("function"!=typeof e){for(var r=e;Array.isArray(r)&&0!==r.length;)r=r[0];"function"!=typeof r&&(t=1,n=e)}var a=u(p.call(arguments,t));if(0===a.length)throw new TypeError("Router.use() requires a middleware function");for(var i=0;i<a.length;i++){if("function"!=typeof(e=a[i]))throw new TypeError("Router.use() requires a middleware function but got a "+g(e));s("use %o %s",n,e.name||"<anonymous>");var l=new o(n,{sensitive:this.caseSensitive,strict:!1,end:!1},e);l.route=void 0,this.stack.push(l)}return this},h.route=function(e){var t=new r(e),n=new o(e,{sensitive:this.caseSensitive,strict:this.strict,end:!0},t.dispatch.bind(t));return n.route=t,this.stack.push(n),t},a.concat("all").forEach((function(e){h[e]=function(t){var n=this.route(t);return n[e].apply(n,p.call(arguments,1)),this}}))},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(1)("express:router:route"),o=n(5),a=n(18),i=n(7),s=Array.prototype.slice,l=Object.prototype.toString;function u(e){this.path=e,this.stack=[],r("new %o",e),this.methods={}}e.exports=u,u.prototype._handles_method=function(e){if(this.methods._all)return!0;var t=e.toLowerCase();return"head"!==t||this.methods.head||(t="get"),Boolean(this.methods[t])},u.prototype._options=function(){var e=Object.keys(this.methods);this.methods.get&&!this.methods.head&&e.push("head");for(var t=0;t<e.length;t++)e[t]=e[t].toUpperCase();return e},u.prototype.dispatch=function(e,t,n){var r=0,o=this.stack;if(0===o.length)return n();var a=e.method.toLowerCase();"head"!==a||this.methods.head||(a="get"),e.route=this,function i(s){if(s&&"route"===s)return n();if(s&&"router"===s)return n(s);var l=o[r++];if(!l)return n(s);if(l.method&&l.method!==a)return i(s);s?l.handle_error(s,e,t,i):l.handle_request(e,t,i)}()},u.prototype.all=function(){for(var e=o(s.call(arguments)),t=0;t<e.length;t++){var n=e[t];if("function"!=typeof n){var r=l.call(n),i="Route.all() requires a callback function but got a "+r;throw new TypeError(i)}var u=a("/",{},n);u.method=void 0,this.methods._all=!0,this.stack.push(u)}return this},i.forEach((function(e){u.prototype[e]=function(){for(var t=o(s.call(arguments)),n=0;n<t.length;n++){var i=t[n];if("function"!=typeof i){var u=l.call(i),c="Route."+e+"() requires a callback function but got a "+u;throw new Error(c)}r("%s %o",e,this.path);var m=a("/",{},i);m.method=e,this.methods[e]=!0,this.stack.push(m)}return this}}))},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(42),o=n(1)("express:router:layer"),a=Object.prototype.hasOwnProperty;function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);o("new %o",e);var a=t||{};this.handle=n,this.name=n.name||"<anonymous>",this.params=void 0,this.path=void 0,this.regexp=r(e,this.keys=[],a),this.regexp.fast_star="*"===e,this.regexp.fast_slash="/"===e&&!1===a.end}function s(e){if("string"!=typeof e||0===e.length)return e;try{return decodeURIComponent(e)}catch(t){throw t instanceof URIError&&(t.message="Failed to decode param '"+e+"'",t.status=t.statusCode=400),t}}e.exports=i,i.prototype.handle_error=function(e,t,n,r){var o=this.handle;if(4!==o.length)return r(e);try{o(e,t,n,r)}catch(e){r(e)}},i.prototype.handle_request=function(e,t,n){var r=this.handle;if(r.length>3)return n();try{r(e,t,n)}catch(e){n(e)}},i.prototype.match=function(e){var t;if(null!=e){if(this.regexp.fast_slash)return this.params={},this.path="",!0;if(this.regexp.fast_star)return this.params={0:s(e)},this.path=e,!0;t=this.regexp.exec(e)}if(!t)return this.params=void 0,this.path=void 0,!1;this.params={},this.path=t[0];for(var n=this.keys,r=this.params,o=1;o<t.length;o++){var i=n[o-1].name,l=s(t[o]);void 0===l&&a.call(r,i)||(r[i]=l)}return!0}},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(6),o=n(8),a=n(20);e.exports=function(e){var t=r({},e),n=a.parse;return"function"==typeof e&&(n=e,t=void 0),void 0!==t&&void 0===t.allowPrototypes&&(t.allowPrototypes=!0),function(e,r,a){if(!e.query){var i=o(e).query;e.query=n(i,t)}a()}}},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("safe-buffer")},function(e,t){e.exports=require("content-disposition")},function(e,t){e.exports=require("send")},function(e,t){e.exports=require("proxy-addr")},function(e,t){e.exports=require("type-is")},function(e,t,n){var r=n(68);var o=function(e){var t,n=e.constructor===Array?[]:{};if("object"==typeof e){if(r)t=r.stringify(e),n=r.parse(t);else for(var a in e)n[a]="object"==typeof e[a]?o(e[a]):e[a];return n}};e.exports={saveThumbnail:function(e){if(e.thumbnails&&e.thumbnails.length>0){var t="../static/"+e.thumbnails.originalname;fs.readFile(e.thumbnails.path,(function(n,r){fs.writeFile(t,r,(function(n){n?console.log(n):(response={message:"File uploaded successfully",filename:e.thumbnails.originalname},console.log("文件上传成功："+t),res.end(JSON.stringify(response)))}))}))}},createJson:function(e){var t={};for(var n in e)null!==e[n]&&""!==e[n]&&(t[n]=e[n]);return t},createSuccess:function(e,t,n){var r={};return void 0!==n&&""!==n&&(r.data=n),r.code=e,r.mes=t,r},cloneObj:o,createSuccessList:function(e,t,n,r,o){var a={};return void 0!==o&&""!==o&&o.length>0&&(a.data=o),a.code=e,a.mes=t,a.count=n,a.currentPage=r,a},table2JSON:function(e){return"select array_to_json(array_agg(row_to_json(t)))from ( select * from {tablename}) t".replace("{tablename}",e)},table2JSONDesc:function(e){return"select array_to_json(array_agg(row_to_json(t)))from ( select * from {tablename} order by id desc) t".replace("{tablename}",e)},table2JSONWhere:function(e,t){return"select array_to_json(array_agg(row_to_json(t)))from ( select * from {tablename} where {where}) t".replace("{tablename}",e).replace("{where}",t)}}},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],a=o.obj[o.prop],i=Object.keys(a),s=0;s<i.length;++s){var l=i[s],u=a[l];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:a,prop:l}),n.push(u))}return function(e){for(var t;e.length;){var n=e.pop();if(t=n.obj[n.prop],Array.isArray(t)){for(var r=[],o=0;o<t.length;++o)void 0!==t[o]&&r.push(t[o]);n.obj[n.prop]=r}}return t}(t)},decode:function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},encode:function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),n="",r=0;r<t.length;++r){var a=t.charCodeAt(r);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?n+=t.charAt(r):a<128?n+=o[a]:a<2048?n+=o[192|a>>6]+o[128|63&a]:a<55296||a>=57344?n+=o[224|a>>12]+o[128|a>>6&63]+o[128|63&a]:(r+=1,a=65536+((1023&a)<<10|1023&t.charCodeAt(r)),n+=o[240|a>>18]+o[128|a>>12&63]+o[128|a>>6&63]+o[128|63&a])}return n},isBuffer:function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,n,o){if(!n)return t;if("object"!=typeof n){if(Array.isArray(t))t.push(n);else{if("object"!=typeof t)return[t,n];(o.plainObjects||o.allowPrototypes||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if("object"!=typeof t)return[t].concat(n);var i=t;return Array.isArray(t)&&!Array.isArray(n)&&(i=a(t,o)),Array.isArray(t)&&Array.isArray(n)?(n.forEach((function(n,a){r.call(t,a)?t[a]&&"object"==typeof t[a]?t[a]=e(t[a],n,o):t.push(n):t[a]=n})),t):Object.keys(n).reduce((function(t,a){var i=n[a];return r.call(t,a)?t[a]=e(t[a],i,o):t[a]=i,t}),i)}}},function(e,t,n){"use strict";var r=String.prototype.replace,o=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return r.call(e,o,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,n){var r=new(n(30).Client)("tcp://postgres:123456@localhost/dihuan");r.connect((function(e,t){if(e)return console.log("ClientConnectionReady Error: "+e.message),void r.end();console.log("pgClient.connect OK.\n")})),e.exports=r},function(e,t){e.exports=require("pg")},function(e,t){e.exports=require("multer")},function(e,t,n){var r=n(80),o={LIMIT_PART_COUNT:"Too many parts",LIMIT_FILE_SIZE:"File too large",LIMIT_FILE_COUNT:"Too many files",LIMIT_FIELD_KEY:"Field name too long",LIMIT_FIELD_VALUE:"Field value too long",LIMIT_FIELD_COUNT:"Too many fields",LIMIT_UNEXPECTED_FILE:"Unexpected field"};function a(e,t){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=o[e],this.code=e,t&&(this.field=t)}r.inherits(a,Error),e.exports=a},function(e,t){e.exports={serverPort:8007,serverIP:"localhost",serverPath:"D:/Uninpho/dhserver"}},function(e,t){function n(e){var t={error:!0,code:500};return t.mes=e,t}function r(e){var t={};return t.data=e,t.code="200",t.mes="成功",t}e.exports={createJson:function(e){var t={};for(var n in e)null!==e[n]&&""!==e[n]&&(t[n]=e[n]);return t},createSuccess:r,createSuccessList:function(e,t,n,r,o){var a={};return void 0!==o&&""!==o&&o.length>0&&(a.data=o),a.code=e,a.mes=t,a.count=n,a.currentPage=r,a},table2JSON:function(e){return`select * from ${e}`},table2JSONWhere:function(e,t){return`select * from ${e} where ${t}`},createException:n,table2JSONAdd:function(e,t,n){return`INSERT INTO ${e} (${t}) VALUES (${n})`},doQueryCb:function(e){let t={};return t=e.error?n(e.message):r(e.rows),t},table2JSONremove:function(e,t,n){return`DELETE FROM ${e} WHERE ${t} = ${n}`},table2JSONupdate:function(e,t,n){return`UPDATE ${e} SET ${t} WHERE ${n}`},table2JSONqueryByKV:function(e,t,n,r){return r?`select * from ${e} where ${t} like '%${n}%' `:`select * from ${e} where ${t} = ${n} `},table2JSONqueryByWhere:function(e,t){return`select * from ${e} where  ${t} `}}},function(e,t){e.exports={metalTabel:{name:"m_table",fields:[{name:"id",comment:"主键",type:"integer",isKey:!0},{name:"tablename",comment:"表名",type:"text"},{name:"chname",comment:"中文名",type:"text"},{name:"key",comment:"主键字段",type:"text"},{name:"svcname",comment:"服务名称",type:"text"},{name:"inuse",comment:"是否需要发布服务",type:"integer"},{name:"operation",comment:"服务操作",type:"text"},{name:"descreption",comment:"描述信息",type:"text"}]},metalColumn:{name:"m_field",fields:[{name:"id",comment:"主键",type:"integer",isKey:!0},{name:"tableid",comment:"所属表的id,外键",type:"integer"},{name:"fieldname",comment:"字段名",type:"text"},{name:"chname",comment:"字段中文名",type:"text"},{name:"type",comment:"字段类型",type:"text"},{name:"isquery",comment:"是否需要查询",type:"integer"},{name:"nullable",comment:"是否允许为空",type:"integer"},{name:"isedit",comment:"是否允许编辑",type:"integer"},{name:"width",comment:"字段长度",type:"integer"},{name:"descreption",comment:"描述信息",type:"text"}]}}},function(e,t,n){var r=n(37),o=n(62),a=n(14),i=n(65);let s=n(33),l=n(90);var u=r();u.use(o("dev")),u.use(a.json({limit:"50mb"})),u.use(a.urlencoded({limit:"50mb",extended:!0}));var c=s.serverPort,m=s.serverIP;u.listen(c,m,(function(){console.log(`Server running at http://${m}:${c}/`)})),u.use("/upload/",r.static("./upload/")),u.use("/static/",r.static("./static/")),u.disable("etag"),u.all("*",(function(e,t,n){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.header("Access-Control-Allow-Methods","PUT,POST,GET,DELETE,OPTIONS"),t.header("X-Powered-By"," 3.2.1"),t.header("Content-Type","application/json;charset=utf-8"),t.header("Cache-Control","no-cache, no-store, must-revalidate"),t.header("Pragma","no-cache"),t.header("Expires",0),n()})),l.initServer(u),i.initAPI(u),process.on("uncaughtException",(function(e){console.log(e),console.log(e.stack)}))},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */e.exports=n(38)},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(14),o=n(15).EventEmitter,a=n(39),i=n(40),s=n(17),l=n(16),u=n(49),c=n(54);(t=e.exports=function(){var e=function(t,n,r){e.handle(t,n,r)};return a(e,o.prototype,!1),a(e,i,!1),e.request=Object.create(u,{app:{configurable:!0,enumerable:!0,writable:!0,value:e}}),e.response=Object.create(c,{app:{configurable:!0,enumerable:!0,writable:!0,value:e}}),e.init(),e}).application=i,t.request=u,t.response=c,t.Route=s,t.Router=l,t.json=r.json,t.query=n(19),t.static=n(61),t.urlencoded=r.urlencoded;["bodyParser","compress","cookieSession","session","logger","cookieParser","favicon","responseTime","errorHandler","timeout","methodOverride","vhost","csrf","directory","limit","multipart","staticCache"].forEach((function(e){Object.defineProperty(t,e,{get:function(){throw new Error("Most middleware (like "+e+") is no longer bundled with Express and must be installed separately. Please see https://github.com/senchalabs/connect#middleware.")},configurable:!0})}))},function(e,t){e.exports=require("merge-descriptors")},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(41),o=n(16),a=n(7),i=n(43),s=n(19),l=n(1)("express:application"),u=n(44),c=n(10),m=n(0).compileETag,f=n(0).compileQueryParser,p=n(0).compileTrust,d=n(2)("express"),h=n(5),y=n(6),g=n(3).resolve,v=n(9),b=Array.prototype.slice,w=e.exports={};function x(e){"test"!==this.get("env")&&console.error(e.stack||e.toString())}w.init=function(){this.cache={},this.engines={},this.settings={},this.defaultConfiguration()},w.defaultConfiguration=function(){var e="production";this.enable("x-powered-by"),this.set("etag","weak"),this.set("env",e),this.set("query parser","extended"),this.set("subdomain offset",2),this.set("trust proxy",!1),Object.defineProperty(this.settings,"@@symbol:trust_proxy_default",{configurable:!0,value:!0}),l("booting in %s mode",e),this.on("mount",(function(e){!0===this.settings["@@symbol:trust_proxy_default"]&&"function"==typeof e.settings["trust proxy fn"]&&(delete this.settings["trust proxy"],delete this.settings["trust proxy fn"]),v(this.request,e.request),v(this.response,e.response),v(this.engines,e.engines),v(this.settings,e.settings)})),this.locals=Object.create(null),this.mountpath="/",this.locals.settings=this.settings,this.set("view",u),this.set("views",g("views")),this.set("jsonp callback name","callback"),this.enable("view cache"),Object.defineProperty(this,"router",{get:function(){throw new Error("'app.router' is deprecated!\nPlease see the 3.x to 4.x migration guide for details on how to update your app.")}})},w.lazyrouter=function(){this._router||(this._router=new o({caseSensitive:this.enabled("case sensitive routing"),strict:this.enabled("strict routing")}),this._router.use(s(this.get("query parser fn"))),this._router.use(i.init(this)))},w.handle=function(e,t,n){var o=this._router,a=n||r(e,t,{env:this.get("env"),onerror:x.bind(this)});if(!o)return l("no routes defined on app"),void a();o.handle(e,t,a)},w.use=function(e){var t=0,n="/";if("function"!=typeof e){for(var r=e;Array.isArray(r)&&0!==r.length;)r=r[0];"function"!=typeof r&&(t=1,n=e)}var o=h(b.call(arguments,t));if(0===o.length)throw new TypeError("app.use() requires a middleware function");this.lazyrouter();var a=this._router;return o.forEach((function(e){if(!e||!e.handle||!e.set)return a.use(n,e);l(".use app under %s",n),e.mountpath=n,e.parent=this,a.use(n,(function(t,n,r){var o=t.app;e.handle(t,n,(function(e){v(t,o.request),v(n,o.response),r(e)}))})),e.emit("mount",this)}),this),this},w.route=function(e){return this.lazyrouter(),this._router.route(e)},w.engine=function(e,t){if("function"!=typeof t)throw new Error("callback function required");var n="."!==e[0]?"."+e:e;return this.engines[n]=t,this},w.param=function(e,t){if(this.lazyrouter(),Array.isArray(e)){for(var n=0;n<e.length;n++)this.param(e[n],t);return this}return this._router.param(e,t),this},w.set=function(e,t){if(1===arguments.length)return this.settings[e];switch(l('set "%s" to %o',e,t),this.settings[e]=t,e){case"etag":this.set("etag fn",m(t));break;case"query parser":this.set("query parser fn",f(t));break;case"trust proxy":this.set("trust proxy fn",p(t)),Object.defineProperty(this.settings,"@@symbol:trust_proxy_default",{configurable:!0,value:!1})}return this},w.path=function(){return this.parent?this.parent.path()+this.mountpath:""},w.enabled=function(e){return Boolean(this.set(e))},w.disabled=function(e){return!this.set(e)},w.enable=function(e){return this.set(e,!0)},w.disable=function(e){return this.set(e,!1)},a.forEach((function(e){w[e]=function(t){if("get"===e&&1===arguments.length)return this.set(t);this.lazyrouter();var n=this._router.route(t);return n[e].apply(n,b.call(arguments,1)),this}})),w.all=function(e){this.lazyrouter();for(var t=this._router.route(e),n=b.call(arguments,1),r=0;r<a.length;r++)t[a[r]].apply(t,n);return this},w.del=d.function(w.delete,"app.del: Use app.delete instead"),w.render=function(e,t,n){var r,o=this.cache,a=n,i=this.engines,s=t,l={};if("function"==typeof t&&(a=t,s={}),y(l,this.locals),s._locals&&y(l,s._locals),y(l,s),null==l.cache&&(l.cache=this.enabled("view cache")),l.cache&&(r=o[e]),!r){if(!(r=new(this.get("view"))(e,{defaultEngine:this.get("view engine"),root:this.get("views"),engines:i})).path){var u=Array.isArray(r.root)&&r.root.length>1?'directories "'+r.root.slice(0,-1).join('", "')+'" or "'+r.root[r.root.length-1]+'"':'directory "'+r.root+'"',c=new Error('Failed to lookup view "'+e+'" in views '+u);return c.view=r,a(c)}l.cache&&(o[e]=r)}!function(e,t,n){try{e.render(t,n)}catch(e){n(e)}}(r,l,a)},w.listen=function(){var e=c.createServer(this);return e.listen.apply(e,arguments)}},function(e,t){e.exports=require("finalhandler")},function(e,t){e.exports=require("path-to-regexp")},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(9);t.init=function(e){return function(t,n,o){e.enabled("x-powered-by")&&n.setHeader("X-Powered-By","Express"),t.res=n,n.req=t,t.next=o,r(t,e.request),r(n,e.response),n.locals=n.locals||Object.create(null),o()}}},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(1)("express:view"),o=n(3),a=n(4),i=o.dirname,s=o.basename,l=o.extname,u=o.join,c=o.resolve;function m(e,t){var o=t||{};if(this.defaultEngine=o.defaultEngine,this.ext=l(e),this.name=e,this.root=o.root,!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");var a=e;if(this.ext||(this.ext="."!==this.defaultEngine[0]?"."+this.defaultEngine:this.defaultEngine,a+=this.ext),!o.engines[this.ext]){var i=this.ext.substr(1);r('require "%s"',i);var s=n(45)(i).__express;if("function"!=typeof s)throw new Error('Module "'+i+'" does not provide a view engine.');o.engines[this.ext]=s}this.engine=o.engines[this.ext],this.path=this.lookup(a)}function f(e){r('stat "%s"',e);try{return a.statSync(e)}catch(e){return}}e.exports=m,m.prototype.lookup=function(e){var t,n=[].concat(this.root);r('lookup "%s"',e);for(var o=0;o<n.length&&!t;o++){var a=n[o],l=c(a,e),u=i(l),m=s(l);t=this.resolve(u,m)}return t},m.prototype.render=function(e,t){r('render "%s"',this.path),this.engine(this.path,e,t)},m.prototype.resolve=function(e,t){var n=this.ext,r=u(e,t),o=f(r);return o&&o.isFile()?r:(o=f(r=u(e,s(t,n),"index"+n)))&&o.isFile()?r:void 0}},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=45},function(e,t){e.exports=require("content-type")},function(e,t){e.exports=require("etag")},function(e,t){e.exports=require("querystring")},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(50),o=n(2)("express"),a=n(51).isIP,i=n(25),s=n(10),l=n(52),u=n(53),c=n(8),m=n(24),f=Object.create(s.IncomingMessage.prototype);function p(e,t,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n})}e.exports=f,f.get=f.header=function(e){if(!e)throw new TypeError("name argument is required to req.get");if("string"!=typeof e)throw new TypeError("name must be a string to req.get");var t=e.toLowerCase();switch(t){case"referer":case"referrer":return this.headers.referrer||this.headers.referer;default:return this.headers[t]}},f.accepts=function(){var e=r(this);return e.types.apply(e,arguments)},f.acceptsEncodings=function(){var e=r(this);return e.encodings.apply(e,arguments)},f.acceptsEncoding=o.function(f.acceptsEncodings,"req.acceptsEncoding: Use acceptsEncodings instead"),f.acceptsCharsets=function(){var e=r(this);return e.charsets.apply(e,arguments)},f.acceptsCharset=o.function(f.acceptsCharsets,"req.acceptsCharset: Use acceptsCharsets instead"),f.acceptsLanguages=function(){var e=r(this);return e.languages.apply(e,arguments)},f.acceptsLanguage=o.function(f.acceptsLanguages,"req.acceptsLanguage: Use acceptsLanguages instead"),f.range=function(e,t){var n=this.get("Range");if(n)return u(e,n,t)},f.param=function(e,t){var n=this.params||{},r=this.body||{},a=this.query||{},i=1===arguments.length?"name":"name, default";return o("req.param("+i+"): Use req.params, req.body, or req.query instead"),null!=n[e]&&n.hasOwnProperty(e)?n[e]:null!=r[e]?r[e]:null!=a[e]?a[e]:t},f.is=function(e){var t=e;if(!Array.isArray(e)){t=new Array(arguments.length);for(var n=0;n<t.length;n++)t[n]=arguments[n]}return i(this,t)},p(f,"protocol",(function(){var e=this.connection.encrypted?"https":"http";if(!this.app.get("trust proxy fn")(this.connection.remoteAddress,0))return e;var t=this.get("X-Forwarded-Proto")||e,n=t.indexOf(",");return-1!==n?t.substring(0,n).trim():t.trim()})),p(f,"secure",(function(){return"https"===this.protocol})),p(f,"ip",(function(){var e=this.app.get("trust proxy fn");return m(this,e)})),p(f,"ips",(function(){var e=this.app.get("trust proxy fn"),t=m.all(this,e);return t.reverse().pop(),t})),p(f,"subdomains",(function(){var e=this.hostname;if(!e)return[];var t=this.app.get("subdomain offset"),n=a(e)?[e]:e.split(".").reverse();return n.slice(t)})),p(f,"path",(function(){return c(this).pathname})),p(f,"hostname",(function(){var e=this.app.get("trust proxy fn"),t=this.get("X-Forwarded-Host");if(t&&e(this.connection.remoteAddress,0)||(t=this.get("Host")),t){var n="["===t[0]?t.indexOf("]")+1:0,r=t.indexOf(":",n);return-1!==r?t.substring(0,r):t}})),p(f,"host",o.function((function(){return this.hostname}),"req.host: Use req.hostname instead")),p(f,"fresh",(function(){var e=this.method,t=this.res,n=t.statusCode;return("GET"===e||"HEAD"===e)&&((n>=200&&n<300||304===n)&&l(this.headers,{etag:t.get("ETag"),"last-modified":t.get("Last-Modified")}))})),p(f,"stale",(function(){return!this.fresh})),p(f,"xhr",(function(){return"xmlhttprequest"===(this.get("X-Requested-With")||"").toLowerCase()}))},function(e,t){e.exports=require("accepts")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("fresh")},function(e,t){e.exports=require("range-parser")},function(e,t,n){"use strict";
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(21).Buffer,o=n(22),a=n(2)("express"),i=n(55),s=n(56),l=n(10),u=n(0).isAbsolute,c=n(11),m=n(3),f=n(57),p=n(6),d=n(58).sign,h=n(0).normalizeType,y=n(0).normalizeTypes,g=n(0).setCharset,v=n(59),b=n(23),w=m.extname,x=b.mime,_=m.resolve,E=n(60),k=Object.create(l.ServerResponse.prototype);e.exports=k;var q=/;\s*charset\s*=/;function A(e,t,n,r){var o,a=!1;function i(){if(!a){a=!0;var e=new Error("Request aborted");e.code="ECONNABORTED",r(e)}}function s(e){a||(a=!0,r(e))}t.on("directory",(function(){if(!a){a=!0;var e=new Error("EISDIR, read");e.code="EISDIR",r(e)}})),t.on("end",(function(){a||(a=!0,r())})),t.on("error",s),t.on("file",(function(){o=!1})),t.on("stream",(function(){o=!0})),c(e,(function(e){return e&&"ECONNRESET"===e.code?i():e?s(e):void(a||setImmediate((function(){!1===o||a?a||(a=!0,r()):i()})))})),n.headers&&t.on("headers",(function(e){for(var t=n.headers,r=Object.keys(t),o=0;o<r.length;o++){var a=r[o];e.setHeader(a,t[a])}})),t.pipe(e)}function N(e,t,n,r){var o=t||n?JSON.stringify(e,t,n):JSON.stringify(e);return r&&(o=o.replace(/[<>&]/g,(function(e){switch(e.charCodeAt(0)){case 60:return"\\u003c";case 62:return"\\u003e";case 38:return"\\u0026";default:return e}}))),o}k.status=function(e){return this.statusCode=e,this},k.links=function(e){var t=this.get("Link")||"";return t&&(t+=", "),this.set("Link",t+Object.keys(e).map((function(t){return"<"+e[t]+'>; rel="'+t+'"'})).join(", "))},k.send=function(e){var t,n,o=e,i=this.req,s=this.app;switch(2===arguments.length&&("number"!=typeof arguments[0]&&"number"==typeof arguments[1]?(a("res.send(body, status): Use res.status(status).send(body) instead"),this.statusCode=arguments[1]):(a("res.send(status, body): Use res.status(status).send(body) instead"),this.statusCode=arguments[0],o=arguments[1])),"number"==typeof o&&1===arguments.length&&(this.get("Content-Type")||this.type("txt"),a("res.send(status): Use res.sendStatus(status) instead"),this.statusCode=o,o=f[o]),typeof o){case"string":this.get("Content-Type")||this.type("html");break;case"boolean":case"number":case"object":if(null===o)o="";else{if(!r.isBuffer(o))return this.json(o);this.get("Content-Type")||this.type("bin")}}"string"==typeof o&&(t="utf8","string"==typeof(n=this.get("Content-Type"))&&this.set("Content-Type",g(n,"utf-8")));var l,u,c=s.get("etag fn"),m=!this.get("ETag")&&"function"==typeof c;return void 0!==o&&(r.isBuffer(o)?l=o.length:!m&&o.length<1e3?l=r.byteLength(o,t):(o=r.from(o,t),t=void 0,l=o.length),this.set("Content-Length",l)),m&&void 0!==l&&(u=c(o,t))&&this.set("ETag",u),i.fresh&&(this.statusCode=304),204!==this.statusCode&&304!==this.statusCode||(this.removeHeader("Content-Type"),this.removeHeader("Content-Length"),this.removeHeader("Transfer-Encoding"),o=""),"HEAD"===i.method?this.end():this.end(o,t),this},k.json=function(e){var t=e;2===arguments.length&&("number"==typeof arguments[1]?(a("res.json(obj, status): Use res.status(status).json(obj) instead"),this.statusCode=arguments[1]):(a("res.json(status, obj): Use res.status(status).json(obj) instead"),this.statusCode=arguments[0],t=arguments[1]));var n=this.app,r=n.get("json escape"),o=n.get("json replacer"),i=n.get("json spaces"),s=N(t,o,i,r);return this.get("Content-Type")||this.set("Content-Type","application/json"),this.send(s)},k.jsonp=function(e){var t=e;2===arguments.length&&("number"==typeof arguments[1]?(a("res.jsonp(obj, status): Use res.status(status).json(obj) instead"),this.statusCode=arguments[1]):(a("res.jsonp(status, obj): Use res.status(status).jsonp(obj) instead"),this.statusCode=arguments[0],t=arguments[1]));var n=this.app,r=n.get("json escape"),o=n.get("json replacer"),i=n.get("json spaces"),s=N(t,o,i,r),l=this.req.query[n.get("jsonp callback name")];return this.get("Content-Type")||(this.set("X-Content-Type-Options","nosniff"),this.set("Content-Type","application/json")),Array.isArray(l)&&(l=l[0]),"string"==typeof l&&0!==l.length&&(this.set("X-Content-Type-Options","nosniff"),this.set("Content-Type","text/javascript"),s="/**/ typeof "+(l=l.replace(/[^\[\]\w$.]/g,""))+" === 'function' && "+l+"("+(s=s.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"))+");"),this.send(s)},k.sendStatus=function(e){var t=f[e]||String(e);return this.statusCode=e,this.type("txt"),this.send(t)},k.sendFile=function(e,t,n){var r=n,o=this.req,a=o.next,i=t||{};if(!e)throw new TypeError("path argument is required to res.sendFile");if("function"==typeof t&&(r=t,i={}),!i.root&&!u(e))throw new TypeError("path must be absolute or specify root to res.sendFile");var s=encodeURI(e);A(this,b(o,s,i),i,(function(e){return r?r(e):e&&"EISDIR"===e.code?a():void(e&&"ECONNABORTED"!==e.code&&"write"!==e.syscall&&a(e))}))},k.sendfile=function(e,t,n){var r=n,o=this.req,a=o.next,i=t||{};"function"==typeof t&&(r=t,i={}),A(this,b(o,e,i),i,(function(e){return r?r(e):e&&"EISDIR"===e.code?a():void(e&&"ECONNABORTED"!==e.code&&"write"!==e.syscall&&a(e))}))},k.sendfile=a.function(k.sendfile,"res.sendfile: Use res.sendFile instead"),k.download=function(e,t,n,r){var a=r,i=t,s=n||null;"function"==typeof t?(a=t,i=null,s=null):"function"==typeof n&&(a=n,s=null);var l={"Content-Disposition":o(i||e)};if(s&&s.headers)for(var u=Object.keys(s.headers),c=0;c<u.length;c++){var m=u[c];"content-disposition"!==m.toLowerCase()&&(l[m]=s.headers[m])}(s=Object.create(s)).headers=l;var f=_(e);return this.sendFile(f,s,a)},k.contentType=k.type=function(e){var t=-1===e.indexOf("/")?x.lookup(e):e;return this.set("Content-Type",t)},k.format=function(e){var t=this.req,n=t.next,r=e.default;r&&delete e.default;var o=Object.keys(e),a=o.length>0&&t.accepts(o);if(this.vary("Accept"),a)this.set("Content-Type",h(a).value),e[a](t,this,n);else if(r)r();else{var i=new Error("Not Acceptable");i.status=i.statusCode=406,i.types=y(o).map((function(e){return e.value})),n(i)}return this},k.attachment=function(e){return e&&this.type(w(e)),this.set("Content-Disposition",o(e)),this},k.append=function(e,t){var n=this.get(e),r=t;return n&&(r=Array.isArray(n)?n.concat(t):Array.isArray(t)?[n].concat(t):[n,t]),this.set(e,r)},k.set=k.header=function(e,t){if(2===arguments.length){var n=Array.isArray(t)?t.map(String):String(t);if("content-type"===e.toLowerCase()){if(Array.isArray(n))throw new TypeError("Content-Type cannot be set to an Array");if(!q.test(n)){var r=x.charsets.lookup(n.split(";")[0]);r&&(n+="; charset="+r.toLowerCase())}}this.setHeader(e,n)}else for(var o in e)this.set(o,e[o]);return this},k.get=function(e){return this.getHeader(e)},k.clearCookie=function(e,t){var n=p({expires:new Date(1),path:"/"},t);return this.cookie(e,"",n)},k.cookie=function(e,t,n){var r=p({},n),o=this.req.secret,a=r.signed;if(a&&!o)throw new Error('cookieParser("secret") required for signed cookies');var i="object"==typeof t?"j:"+JSON.stringify(t):String(t);return a&&(i="s:"+d(i,o)),"maxAge"in r&&(r.expires=new Date(Date.now()+r.maxAge),r.maxAge/=1e3),null==r.path&&(r.path="/"),this.append("Set-Cookie",v.serialize(e,String(i),r)),this},k.location=function(e){var t=e;return"back"===e&&(t=this.req.get("Referrer")||"/"),this.set("Location",i(t))},k.redirect=function(e){var t,n=e,o=302;2===arguments.length&&("number"==typeof arguments[0]?(o=arguments[0],n=arguments[1]):(a("res.redirect(url, status): Use res.redirect(status, url) instead"),o=arguments[1])),n=this.location(n).get("Location"),this.format({text:function(){t=f[o]+". Redirecting to "+n},html:function(){var e=s(n);t="<p>"+f[o]+'. Redirecting to <a href="'+e+'">'+e+"</a></p>"},default:function(){t=""}}),this.statusCode=o,this.set("Content-Length",r.byteLength(t)),"HEAD"===this.req.method?this.end():this.end(t)},k.vary=function(e){return!e||Array.isArray(e)&&!e.length?(a("res.vary(): Provide a field name"),this):(E(this,e),this)},k.render=function(e,t,n){var r=this.req.app,o=n,a=t||{},i=this.req,s=this;"function"==typeof t&&(o=t,a={}),a._locals=s.locals,o=o||function(e,t){if(e)return i.next(e);s.send(t)},r.render(e,a,o)}},function(e,t){e.exports=require("encodeurl")},function(e,t){e.exports=require("escape-html")},function(e,t){e.exports=require("statuses")},function(e,t){e.exports=require("cookie-signature")},function(e,t){e.exports=require("cookie")},function(e,t){e.exports=require("vary")},function(e,t){e.exports=require("serve-static")},function(e,t,n){"use strict";
/*!
 * morgan
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */e.exports=u,e.exports.compile=c,e.exports.format=function(e,t){return u[e]=t,this},e.exports.token=function(e,t){return u[e]=t,this};var r=n(63),o=n(1)("morgan"),a=n(2)("morgan"),i=n(11),s=n(64),l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function u(e,t){var n=e,r=t||{};e&&"object"==typeof e&&(n=(r=e).format||"default",a("morgan(options): use morgan("+("string"==typeof n?JSON.stringify(n):"format")+", options) instead")),void 0===n&&a("undefined format: specify a format");var l=r.immediate,f=r.skip||!1,p="function"!=typeof n?function(e){var t=u[e]||e||u.default;return"function"!=typeof t?c(t):t}(n):n,h=r.buffer,y=r.stream||process.stdout;h&&(a("buffer option"),y=function(e,t){var n=[],r=null;function o(){r=null,e.write(n.join("")),n.length=0}return{write:function(e){null===r&&(r=setTimeout(o,t)),n.push(e)}}}(y,"number"!=typeof h?1e3:h));return function(e,t,n){function r(){if(!1!==f&&f(e,t))o("skip request");else{var n=p(u,e,t);null!=n?(o("log request"),y.write(n+"\n")):o("skip line")}}e._startAt=void 0,e._startTime=void 0,e._remoteAddress=m(e),t._startAt=void 0,t._startTime=void 0,d.call(e),l?r():(s(t,d),i(t,r)),n()}}function c(e){if("string"!=typeof e)throw new TypeError("argument format must be a string");var t='  "use strict"\n  return '+String(JSON.stringify(e)).replace(/:([-\w]{2,})(?:\[([^\]]+)\])?/g,(function(e,t,n){var r="req, res",o="tokens["+String(JSON.stringify(t))+"]";return void 0!==n&&(r+=", "+String(JSON.stringify(n))),'" +\n    ('+o+"("+r+') || "-") + "'}));return new Function("tokens, req, res",t)}function m(e){return e.ip||e._remoteAddress||e.connection&&e.connection.remoteAddress||void 0}function f(e){return"boolean"!=typeof e.headersSent?Boolean(e._header):e.headersSent}function p(e){var t=String(e);return(1===t.length?"0":"")+t}function d(){this._startAt=process.hrtime(),this._startTime=new Date}u.format("combined",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),u.format("common",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]'),u.format("default",':remote-addr - :remote-user [:date] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),a.property(u,"default","default format: use combined format"),u.format("short",":remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms"),u.format("tiny",":method :url :status :res[content-length] - :response-time ms"),u.format("dev",(function e(t,n,r){var o=f(r)?r.statusCode:void 0,a=o>=500?31:o>=400?33:o>=300?36:o>=200?32:0,i=e[a];return i||(i=e[a]=c("[0m:method :url ["+a+"m:status [0m:response-time ms - :res[content-length][0m")),i(t,n,r)})),u.token("url",(function(e){return e.originalUrl||e.url})),u.token("method",(function(e){return e.method})),u.token("response-time",(function(e,t,n){if(e._startAt&&t._startAt)return(1e3*(t._startAt[0]-e._startAt[0])+1e-6*(t._startAt[1]-e._startAt[1])).toFixed(void 0===n?3:n)})),u.token("date",(function(e,t,n){var r=new Date;switch(n||"web"){case"clf":return function(e){var t=e.getUTCDate(),n=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),a=e.getUTCFullYear(),i=l[e.getUTCMonth()];return p(t)+"/"+i+"/"+a+":"+p(n)+":"+p(r)+":"+p(o)+" +0000"}(r);case"iso":return r.toISOString();case"web":return r.toUTCString()}})),u.token("status",(function(e,t){return f(t)?String(t.statusCode):void 0})),u.token("referrer",(function(e){return e.headers.referer||e.headers.referrer})),u.token("remote-addr",m),u.token("remote-user",(function(e){var t=r(e);return t?t.name:void 0})),u.token("http-version",(function(e){return e.httpVersionMajor+"."+e.httpVersionMinor})),u.token("user-agent",(function(e){return e.headers["user-agent"]})),u.token("req",(function(e,t,n){var r=e.headers[n.toLowerCase()];return Array.isArray(r)?r.join(", "):r})),u.token("res",(function(e,t,n){if(f(t)){var r=t.getHeader(n);return Array.isArray(r)?r.join(", "):r}}))},function(e,t){e.exports=require("basic-auth")},function(e,t){e.exports=require("on-headers")},function(e,t,n){let r=n(66),o=n(67),a=n(72),i=n(73);n(74);e.exports={initAPI:function(e){r.tables.filter(t=>{e.get(t.svcName+"list",(function(e,n){o.listJSON(t,e,n)})),e.post(t.svcName+"getAll",(function(e,n){o.getAll(t,e,n)})),e.get(t.svcName+"getAll",(function(e,n){o.getAll(t,e,n)})),e.post(t.svcName+"PgetAll",(function(e,n){o.PgetAll(t,e,n)})),e.get(t.svcName+"PgetAll",(function(e,n){o.PgetAll(t,e,n)})),e.post(t.svcName+"VgetAll",(function(e,n){o.VgetAll(t,e,n)})),e.get(t.svcName+"VgetAll",(function(e,n){o.VgetAll(t,e,n)})),e.post(t.svcName+"getTime",(function(e,n){o.getTime(t,e,n)})),e.get(t.svcName+"getTime",(function(e,n){o.getTime(t,e,n)})),e.post(t.svcName+"getTimeLabel",(function(e,n){o.getTimeLabel(t,e,n)})),e.get(t.svcName+"getTimeLabel",(function(e,n){o.getTimeLabel(t,e,n)})),e.post(t.svcName+"getAll1",(function(e,n){o.getAll1(t,e,n)})),e.get(t.svcName+"getAll1",(function(e,n){o.getAll1(t,e,n)})),e.post(t.svcName+"getByKV",(function(e,n){o.getByKV(t,e,n)})),e.get(t.svcName+"getByKV",(function(e,n){o.getByKV(t,e,n)})),e.post(t.svcName+"getByCircle",(function(e,n){o.getByCircle(t,e,n)})),e.get(t.svcName+"getByCircle",(function(e,n){o.getByCircle(t,e,n)})),e.post(t.svcName+"getByKVUnion",(function(e,n){o.getByKVUnion(t,e,n)})),e.get(t.svcName+"getByKVUnion",(function(e,n){o.getByKVUnion(t,e,n)})),e.post(t.svcName+"getByKVUnion1",(function(e,n){o.getByKVUnion1(t,e,n)})),e.get(t.svcName+"getByKVUnion1",(function(e,n){o.getByKVUnion1(t,e,n)})),e.post(t.svcName+"getnoyearByKVUnion",(function(e,n){o.getnoyearByKVUnion(t,e,n)})),e.get(t.svcName+"getnoyearByKVUnion",(function(e,n){o.getnoyearByKVUnion(t,e,n)})),e.post(t.svcName+"getByKAV",(function(e,n){o.getByKAV(t,e,n)})),e.get(t.svcName+"getByKAV",(function(e,n){o.getByKAV(t,e,n)})),e.post(t.svcName+"getjuxingByKAV",(function(e,n){o.getjuxingByKAV(t,e,n)})),e.get(t.svcName+"getjuxingByKAV",(function(e,n){o.getjuxingByKAV(t,e,n)})),e.post(t.svcName+"getByOnlyyear",(function(e,n){o.getByOnlyyear(t,e,n)})),e.get(t.svcName+"getByOnlyyear",(function(e,n){o.getByOnlyyear(t,e,n)})),e.post(t.svcName+"getByKVseriainoUnion",(function(e,n){o.getByKVseriainoUnion(t,e,n)})),e.get(t.svcName+"getByKVseriainoUnion",(function(e,n){o.getByKVseriainoUnion(t,e,n)})),e.post(t.svcName+"edit",(function(e,n){o.edit(t,e,n)})),e.get(t.svcName+"edit",(function(e,n){o.edit(t,e,n)})),e.post(t.svcName+"editByYear",(function(e,n){o.editByYear(t,e,n)})),e.get(t.svcName+"editByYear",(function(e,n){o.editByYear(t,e,n)})),e.post(t.svcName+"updateUser",(function(e,n){o.updateUser(t,e,n)})),e.get(t.svcName+"updateUser",(function(e,n){o.updateUser(t,e,n)})),e.post(t.svcName+"getAllrole",(function(e,n){o.getAllrole(t,e,n)})),e.get(t.svcName+"getAllrole",(function(e,n){o.getAllrole(t,e,n)})),e.post(t.svcName+"getAllrole2",(function(e,n){o.getAllrole2(t,e,n)})),e.get(t.svcName+"getAllrole2",(function(e,n){o.getAllrole2(t,e,n)})),e.post(t.svcName+"selectName",(function(e,n){o.selectName(t,e,n)})),e.get(t.svcName+"selectName",(function(e,n){o.selectName(t,e,n)})),e.post(t.svcName+"selectNumber",(function(e,n){o.selectNumber(t,e,n)})),e.get(t.svcName+"selectNumber",(function(e,n){o.selectNumber(t,e,n)})),e.post(t.svcName+"add",(function(e,n){o.add(t,e,n)})),e.get(t.svcName+"add",(function(e,n){o.add(t,e,n)})),e.post(t.svcName+"addItem",(function(e,n){o.addItem(t,e,n)})),e.get(t.svcName+"addItem",(function(e,n){o.addItem(t,e,n)})),e.post(t.svcName+"remove",(function(e,n){o.remove(t,e,n)})),e.get(t.svcName+"remove",(function(e,n){o.remove(t,e,n)})),e.post(t.svcName+"update",(function(e,n){o.update(t,e,n)})),e.get(t.svcName+"update",(function(e,n){o.update(t,e,n)}))}),e.use("/upload",a),e.use("/download",i)}}},function(e,t){e.exports={operation:["getAll","editByYear","PgetAll","VgetAll","getTime","getTimeLabel","getByCircle","getAll1","listJSON","getByKV","getByKVUnion","getByKAV","getByKVUnion1","getnoyearByKVUnion","getByKVseriainoUnion","getByOnlyyear","getAllrole","getAllrole2","selectName","selectNumber","getjuxingByKAV","add","edit","addItem","remove","update","updateUser"],tables:[{tableName:"t_userinfo",key:"id",svcName:"/user/",colums:[{name:"username",chname:"用户名",type:"string",isquery:!0,isEdit:!0,width:40,remark:"英文、数字、下滑线"},{name:"password",chname:"密码",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"project",chname:"所属项目",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"lang",chname:"语言",type:"string",isquery:!0,isEdit:!1,width:10,remark:""},{name:"tel",chname:"联系电话",type:"Int",isquery:!0,isEdit:!1,width:15,remark:""},{name:"email",chname:"邮件地址",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"time",chname:"创建时间",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"isadmin",chname:"是否管理员",type:"Int",isquery:!0,isEdit:!0,width:40,remark:""},{name:"userid",chname:"用户id",type:"Int",isquery:!0,isEdit:!0,width:40,remark:""}]},{tableName:"t_user",key:"proid",svcName:"/user1/",colums:[{name:"role",chname:"角色名",type:"string",isquery:!0,isEdit:!0,width:40,remark:"英文、数字、下滑线"},{name:"st_no",chname:"st_no",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"proid",chname:"proid",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"username",chname:"用户名",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"email",chname:"邮箱",type:"string",isquery:!0,isEdit:!1,width:10,remark:""},{name:"work",chname:"工作地点",type:"string",isquery:!0,isEdit:!1,width:15,remark:""},{name:"state",chname:"状态",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"creatdate",chname:"创建时间",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"password",chname:"密码",type:"string",isquery:!0,isEdit:!0,width:40,remark:""},{name:"telnum",chname:"电话",type:"string",isquery:!0,isEdit:!0,width:40,remark:""},{name:"isadmin",chname:"是否为管理员",type:"string",isquery:!0,isEdit:!0,width:40,remark:""}]},{tableName:"t_role",key:"role_id",svcName:"/role/",colums:[{name:"role_id",chname:"role_id",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"rolename",chname:"角色名称",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"roledescribe",chname:"角色描述",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"createdate",chname:"创建日期",type:"string",isquery:!0,isEdit:!1,width:10,remark:""}]},{tableName:"t_power",key:"id",svcName:"/power/",colums:[,{name:"powername",chname:"权限名称",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线"},{name:"powerdescribe",chname:"权限描述",type:"string",isquery:!0,isEdit:!1,width:20,remark:""}]},{tableName:"t_powerrole",key:"id",svcName:"/powerrole/",colums:[{name:"role_id",chname:"role_id",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线"},{name:"power_id",chname:"power_id",type:"string",isquery:!0,isEdit:!1,width:20,remark:""}]},{tableName:"t_log",key:"proid",svcName:"/log/",colums:[{name:"st_no",chname:"st_no",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"username",chname:"用户名",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"chinesename",chname:"中文名字",type:"string",isquery:!0,isEdit:!1,width:10,remark:""},{name:"todowhat",chname:"具体内容",type:"Int",isquery:!0,isEdit:!1,width:15,remark:""},{name:"ip",chname:"ip",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"logtype",chname:"类型",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"logdescribe",chname:"日志描述",type:"Int",isquery:!0,isEdit:!0,width:40,remark:""},{name:"date",chname:"日期",type:"Int",isquery:!0,isEdit:!0,width:40,remark:""}]},{tableName:"sub_point",key:"id1",svcName:"/point_t/",colums:[{name:"name",chname:"点名",type:"string",isquery:!0,isEdit:!0,width:40,remark:"英文、数字、下滑线"},{name:"seriaino",chname:"点号",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线"},{name:"ws_x",chname:"54_x坐标",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"ws_y",chname:"54_y坐标",type:"string",isquery:!0,isEdit:!1,width:10,remark:""},{name:"taiyuan_x",chname:"taiyuan_x坐标",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"taiyuan_y",chname:"taiyuan_y坐标",type:"string",isquery:!0,isEdit:!1,width:10,remark:""},{name:"x",chname:"x坐标",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"y",chname:"y坐标",type:"string",isquery:!0,isEdit:!1,width:10,remark:""}]},{tableName:"sub_point_t",key:"id1",svcName:"/point/",colums:[{name:"name",chname:"点名",type:"string",isquery:!0,isEdit:!0,width:40,remark:"英文、数字、下滑线"},{name:"seriaino",chname:"点号",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线"},{name:"x",chname:"x坐标",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"y",chname:"y坐标",type:"string",isquery:!0,isEdit:!1,width:10,remark:""}]},{tableName:"sub_value",key:"id",svcName:"/pointValue/",colums:[{name:"year",chname:"年份",type:"string",isquery:!0,isEdit:!0,width:40,remark:"英文、数字、下滑线"},{name:"value",chname:"沉降量",type:"string",isquery:!0,isEdit:!1,width:20,remark:""},{name:"seriaino",chname:"点号",type:"string",isquery:!0,isEdit:!1,width:20,remark:"英文、数字、下滑线"},{name:"remark",chname:"备注",type:"string",isquery:!0,isEdit:!1,width:40,remark:""},{name:"image",chname:"图片",type:"string",isquery:!0,isEdit:!1,width:40,remark:""}]},{tableName:"tree_sensor",key:"id",svcName:"/layerresouce/",colums:[{name:"id",chname:"序号",type:"string",isquery:!0,isEdit:!0,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"label",chname:"标签",type:"string",isquery:!0,isEdit:!0,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"project",chname:"所属项目",type:"string",isquery:!0,isEdit:!0,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"parameters",chname:"参数json",type:"string",isquery:!0,isEdit:!0,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"parentsid",chname:"父id",type:"string",isquery:!0,isEdit:!0,width:20,remark:"英文、数字、下滑线，不少于6位"},{name:"level",chname:"层级",type:"string",isquery:!0,isEdit:!0,width:20,remark:"英文、数字、下滑线，不少于6位"}]}]}},function(e,t,n){const r=n(26),o=n(29);n(71);e.exports={getAll:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val;console.log(i);let l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u="sub_point",c="sub_value",m=`select * from ${u} join ${c} on ${u}.seriaino = ${c}.seriaino `;console.log(m),o.query(m,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},VgetAll:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val;console.log(i);let l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u="select * from sub_value";console.log(u),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},PgetAll:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val;console.log(i);let l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u="select * from sub_point";console.log(u),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getTime:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val,l=(t.body[1].key,t.body[2].key,t.body[1].val),u=t.body[2].val;console.log(i);let c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value",p=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where  sub_value.year>='${new Date(l).getFullYear()}' and  sub_value.year<='${new Date(u).getFullYear()}'`;console.log(p),o.query(p,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getTimeLabel:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val,l=(t.body[1].key,t.body[2].key,t.body[1].val),u=t.body[2].val;console.log(i);let c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value",p=`select name,x,y,remark, sum(value) as value from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where sub_value.year>='${new Date(l).getFullYear()}' and  sub_value.year<='${new Date(u).getFullYear()}' group by name,x,y,remark`;o.query(p,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},listJSON:function(e,t,n){let a=e.tableName,i=r.table2JSON(a);o.query(i,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByKV:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val;console.log(i);let l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u="select * from {tablename} where {key} = {val}";u=u.replace("{tablename}",a).replace("{key}",i).replace("{val}",s),console.log(u),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByKVUnion:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=(t.body[1].key,t.body[2].key,t.body[0].val),l=t.body[1].val,u=t.body[2].val,c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value",p=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where sub_point.seriaino= ${s} and  sub_value.year>='${new Date(l).getFullYear()}' and  sub_value.year<='${new Date(u).getFullYear()}'`;console.log(p),o.query(p,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByKAV:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=(t.body[1].key,t.body[2].key,t.body[0].val),l=t.body[1].val,u=t.body[2].val,c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value",p=new Date(l).getFullYear(),d=new Date(u).getFullYear(),h=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where ${t.body[3].val} >= sub_point.x and sub_point.x >= ${t.body[4].val} and ${t.body[5].val}>=sub_point.y and sub_point.y>=${t.body[6].val} and  sub_value.year>='${p}' and  sub_value.year<='${d}'`;console.log(h),o.query(h,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByCircle:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=(t.body[1].key,t.body[2].key,t.body[3].key,t.body[4].key,t.body[0].val),l=t.body[1].val,u=t.body[2].val,c=(t.body[3].val,t.body[4].val,e.colums);c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value",p=new Date(l).getFullYear(),d=new Date(u).getFullYear(),h=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where  circle '((${t.body[3].val},${t.body[4].val}),${t.body[5].val})'  @> point(sub_point.x,sub_point.y) and  sub_value.year>='${p}' and  sub_value.year<='${d}'`;console.log(h),o.query(h,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByKVUnion1:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[3].key,s=(t.body[1].key,t.body[2].key,t.body[3].val),l=t.body[1].val,u=t.body[2].val,c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value",p=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where  polygon '(${s})' @> point(sub_point.x,sub_point.y) and  sub_value.year>='${new Date(l).getFullYear()}' and  sub_value.year<='${new Date(u).getFullYear()}'`;console.log(p),o.query(p,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},add:function(e,t,n){let a,i,s=e.tableName,l=e.colums,u=l.map(e=>e.name),c=t.body;for(i=0;i<t.body.length;i++){let e=c[i],m=[];l.map(t=>{"string"==t.type?m.push("'"+e[t.name]+"'"):e[t.name]&&""!=e[t.name]?m.push(e[t.name]):m.push(0)});let f="INSERT INTO {tablename} ({colums}) VALUES ({valus})";f=f.replace("{tablename}",s).replace("{colums}",u.join(",")).replace("{valus}",m.join(",")),console.log(f),o.query(f,(function(e,t){e?console.log("GetData Error: "+e.message):a=r.createSuccess(200,"成功",t)})),i===t.body.length-1&&n.send(a)}},edit:function(e,t,n){let a,i,s=e.tableName,l=e.colums,u=t.body;for(i=0;i<t.body.length;i++){let c=e.key,m=c+" = "+t.body[i][c],f=u[i],p=[];l.map(e=>{let t,n=f[e.name];t="string"==e.type?e.name+" = '"+n+"'":e.name+" = "+n,p.push(t)});let d="UPDATE {tablename} SET {kv} WHERE {where}";d=d.replace("{tablename}",s).replace("{where}",m).replace("{kv}",p.join(",")),console.log(d),o.query(d,(function(e,t){e?console.log("GetData Error: "+e.message):a=r.createSuccess(200,"成功",t)})),i===t.body.length-1&&n.send(a)}},editByYear:function(e,t,n){let a,i,s=e.tableName,l=e.colums,u=t.body;for(i=0;i<t.body.length;i++){let c=e.key,m="year",f=c+" = "+t.body[i][c],p=m+" = "+t.body[i][m],d=u[i],h=[];l.map(e=>{let t,n=d[e.name];t="string"==e.type?e.name+" = '"+n+"'":e.name+" = "+n,h.push(t)});let y="UPDATE {tablename} SET {kv} WHERE {where} AND {where1}";y=y.replace("{tablename}",s).replace("{where}",f).replace("{where1}",p).replace("{kv}",h.join(",")),console.log(y),o.query(y,(function(e,t){e?console.log("GetData Error: "+e.message):a=r.createSuccess(200,"成功",t)})),i===t.body.length-1&&n.send(a)}},addItem:function(e,t,n){let a,i=e.tableName,s=e.colums,l=s.map(e=>e.name),u=t.body,c=[];s.map(e=>{"string"==e.type?c.push("'"+u[e.name]+"'"):u[e.name]&&""!=u[e.name]?c.push(u[e.name]):c.push(0)});let m="INSERT INTO {tablename} ({colums}) VALUES ({valus})";m=m.replace("{tablename}",i).replace("{colums}",l.join(",")).replace("{valus}",c.join(",")),console.log(m),o.query(m,(function(e,t){e?console.log("GetData Error: "+e.message):(a=r.createSuccess(200,"成功",t),n.send(a))}))},remove:function(e,t,n){let a=e.tableName,i=t.body.key,s=t.body.val,l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u="DELETE FROM {tablename} WHERE {key} = {val}";u=u.replace("{tablename}",a).replace("{key}",i).replace("{val}",s),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},update:function(e,t,n){let a=e.tableName,i=e.key,s=i+" = "+t.body[i],l=e.colums,u="UPDATE {tablename} SET {kv} WHERE {where}",c=t.body,m=[];l.map(e=>{let t,n=c[e.name];t="string"==e.type?e.name+" = '"+n+"'":e.name+" = "+n,m.push(t)}),u=u.replace("{tablename}",a).replace("{where}",s).replace("{kv}",m.join(",")),console.log(u),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getAll1:function(e,t,n){let a=e.tableName;console.log(a);let i=t.body.key,s=t.body.val;console.log(i);let l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u=`select * from ${a}`;console.log(u),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getAllrole:function(e,t,n){let a="select * from t_user join t_role on t_user.role = t_role.role_id";console.log(a),o.query(a,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getAllrole2:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=(t.body[1].key,t.body[2].key,t.body[0].val),l=t.body[1].val,u=t.body[2].val,c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m=s,f=(new Date(l).getFullYear(),new Date(u).getFullYear(),`select * from t_user join t_role on t_user.role = t_role.role_id where t_user.role= ${m}`);console.log(f),o.query(f,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getjuxingByKAV:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=(t.body[1].key,t.body[2].key,t.body[0].val),l=t.body[1].val,u=t.body[2].val,c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")}),new Date(l).getFullYear(),new Date(u).getFullYear(),t.body[3].val,t.body[4].val,t.body[5].val;let m=t.body[6].val,f=`SELECT * from sub_point where x = '${lat}' and y = '${lon}' and ST_Contains( ST_MakePolygon(ST_GeomFromText('LINESTRING ( 121.312350 30.971457 , 121.156783 31.092221 , 121.353250 31.278195 , 121.509125 31.157431 , 121.312350 30.971457 ) ')) ,st_point(121.332378,${m}))`;console.log(f),o.query(f,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getnoyearByKVUnion:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=t.body[0].val,l=e.colums;l.map(e=>e.name),l.map(e=>{e.name==i&&(s="'"+s+"'")});let u="sub_point",c="sub_value",m=`select * from ${u} join ${c} on ${u}.seriaino = ${c}.seriaino where sub_point.seriaino= ${s} `;console.log(m),o.query(m,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},selectName:function(e,t,n){let a=e.tableName;console.log(a);let i="select name from sub_point";console.log(i),o.query(i,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByKVseriainoUnion:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body[0].key,s=(t.body[1].key,t.body[2].key,t.body[0].val),l=t.body[1].val,u=t.body[2].val,c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value";if(null!==l&&""!==l)if(null!==u&&""!==u){let e=s,t=new Date(l).getFullYear(),n=new Date(u).getFullYear();this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where sub_point.seriaino= ${e} and  sub_value.year>='${t}' and  sub_value.year<='${n}'`}else{let e=s,t=new Date(l).getFullYear();this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where sub_point.seriaino= ${e} and  sub_value.year>='${t}'`}else if(null==l||""==l)if(null!==u&&""!==u){let e=s,t=new Date(u).getFullYear();this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where sub_point.seriaino= ${e} and  sub_value.year<='${t}'`}else{let e=s;this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where sub_point.seriaino= ${e} `}console.log(this.sql),o.query(this.sql,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},getByOnlyyear:function(e,t,n){let a=e.tableName;console.log(a),console.log(t.query);let i=t.body.key,s=t.body.val,l=(t.body[1].key,t.body[2].key,t.body[1].val),u=t.body[2].val;console.log(i);let c=e.colums;c.map(e=>e.name),c.map(e=>{e.name==i&&(s="'"+s+"'")});let m="sub_point",f="sub_value";if(null!==l&&""!==l)if(null!==u&&""!==u){let e=new Date(l).getFullYear(),t=new Date(u).getFullYear();this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where  sub_value.year>='${e}' and  sub_value.year<='${t}'`}else{let e=new Date(l).getFullYear();this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where  sub_value.year>='${e}'`}else if(null==l||""==l)if(null!==u&&""!==u){let e=new Date(u).getFullYear();this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino where  sub_value.year<='${e}'`}else this.sql=`select * from ${m} join ${f} on ${m}.seriaino = ${f}.seriaino `;console.log(this.sql),o.query(this.sql,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},updateUser:function(e,t,n){let a=e.tableName,i=e.key,s=i+" = '"+t.body[i]+"'",l=e.colums,u="UPDATE {tablename} SET {kv} WHERE {where}",c=t.body,m=[];l.map(e=>{let t,n=c[e.name];t="string"==e.type?e.name+" = '"+n+"'":e.name+" = "+n,m.push(t)}),u=u.replace("{tablename}",a).replace("{where}",s).replace("{kv}",m.join(",")),console.log(u),o.query(u,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))},selectNumber:function(e,t,n){let a=e.tableName;console.log(a);let i="select seriaino from sub_point";console.log(i),o.query(i,(function(e,t){var o;e?(console.log("GetData Error: "+e.message),o=r.createSuccess(500,e.message,t)):o=r.createSuccess(200,"成功",t),n.send(o)}))}}},function(e,t,n){"use strict";var r=n(69),o=n(70),a=n(28);e.exports={formats:a,parse:o,stringify:r}},function(e,t,n){"use strict";var r=n(27),o=n(28),a={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},i=Date.prototype.toISOString,s={delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,serializeDate:function(e){return i.call(e)},skipNulls:!1,strictNullHandling:!1},l=function e(t,n,o,a,i,l,u,c,m,f,p,d){var h=t;if("function"==typeof u)h=u(n,h);else if(h instanceof Date)h=f(h);else if(null===h){if(a)return l&&!d?l(n,s.encoder):n;h=""}if("string"==typeof h||"number"==typeof h||"boolean"==typeof h||r.isBuffer(h))return l?[p(d?n:l(n,s.encoder))+"="+p(l(h,s.encoder))]:[p(n)+"="+p(String(h))];var y,g=[];if(void 0===h)return g;if(Array.isArray(u))y=u;else{var v=Object.keys(h);y=c?v.sort(c):v}for(var b=0;b<y.length;++b){var w=y[b];i&&null===h[w]||(g=Array.isArray(h)?g.concat(e(h[w],o(n,w),o,a,i,l,u,c,m,f,p,d)):g.concat(e(h[w],n+(m?"."+w:"["+w+"]"),o,a,i,l,u,c,m,f,p,d)))}return g};e.exports=function(e,t){var n=e,i=t?r.assign({},t):{};if(null!==i.encoder&&void 0!==i.encoder&&"function"!=typeof i.encoder)throw new TypeError("Encoder has to be a function.");var u=void 0===i.delimiter?s.delimiter:i.delimiter,c="boolean"==typeof i.strictNullHandling?i.strictNullHandling:s.strictNullHandling,m="boolean"==typeof i.skipNulls?i.skipNulls:s.skipNulls,f="boolean"==typeof i.encode?i.encode:s.encode,p="function"==typeof i.encoder?i.encoder:s.encoder,d="function"==typeof i.sort?i.sort:null,h=void 0!==i.allowDots&&i.allowDots,y="function"==typeof i.serializeDate?i.serializeDate:s.serializeDate,g="boolean"==typeof i.encodeValuesOnly?i.encodeValuesOnly:s.encodeValuesOnly;if(void 0===i.format)i.format=o.default;else if(!Object.prototype.hasOwnProperty.call(o.formatters,i.format))throw new TypeError("Unknown format option provided.");var v,b,w=o.formatters[i.format];"function"==typeof i.filter?n=(b=i.filter)("",n):Array.isArray(i.filter)&&(v=b=i.filter);var x,_=[];if("object"!=typeof n||null===n)return"";x=i.arrayFormat in a?i.arrayFormat:"indices"in i?i.indices?"indices":"repeat":"indices";var E=a[x];v||(v=Object.keys(n)),d&&v.sort(d);for(var k=0;k<v.length;++k){var q=v[k];m&&null===n[q]||(_=_.concat(l(n[q],q,E,c,m,f?p:null,b,d,h,y,w,g)))}var A=_.join(u),N=!0===i.addQueryPrefix?"?":"";return A.length>0?N+A:""}},function(e,t,n){"use strict";var r=n(27),o=Object.prototype.hasOwnProperty,a={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:r.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},i=function(e,t,n){if(e){var r=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(r),s=i?r.slice(0,i.index):r,l=[];if(s){if(!n.plainObjects&&o.call(Object.prototype,s)&&!n.allowPrototypes)return;l.push(s)}for(var u=0;null!==(i=a.exec(r))&&u<n.depth;){if(u+=1,!n.plainObjects&&o.call(Object.prototype,i[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(i[1])}return i&&l.push("["+r.slice(i.index)+"]"),function(e,t,n){for(var r=t,o=e.length-1;o>=0;--o){var a,i=e[o];if("[]"===i)a=(a=[]).concat(r);else{a=n.plainObjects?Object.create(null):{};var s="["===i.charAt(0)&&"]"===i.charAt(i.length-1)?i.slice(1,-1):i,l=parseInt(s,10);!isNaN(l)&&i!==s&&String(l)===s&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(a=[])[l]=r:a[s]=r}r=a}return r}(l,t,n)}};e.exports=function(e,t){var n=t?r.assign({},t):{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.ignoreQueryPrefix=!0===n.ignoreQueryPrefix,n.delimiter="string"==typeof n.delimiter||r.isRegExp(n.delimiter)?n.delimiter:a.delimiter,n.depth="number"==typeof n.depth?n.depth:a.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:a.arrayLimit,n.parseArrays=!1!==n.parseArrays,n.decoder="function"==typeof n.decoder?n.decoder:a.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:a.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:a.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:a.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:a.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:a.strictNullHandling,""===e||null==e)return n.plainObjects?Object.create(null):{};for(var s="string"==typeof e?function(e,t){for(var n={},r=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,i=t.parameterLimit===1/0?void 0:t.parameterLimit,s=r.split(t.delimiter,i),l=0;l<s.length;++l){var u,c,m=s[l],f=m.indexOf("]="),p=-1===f?m.indexOf("="):f+1;-1===p?(u=t.decoder(m,a.decoder),c=t.strictNullHandling?null:""):(u=t.decoder(m.slice(0,p),a.decoder),c=t.decoder(m.slice(p+1),a.decoder)),o.call(n,u)?n[u]=[].concat(n[u]).concat(c):n[u]=c}return n}(e,n):e,l=n.plainObjects?Object.create(null):{},u=Object.keys(s),c=0;c<u.length;++c){var m=u[c],f=i(m,s[m],n);l=r.merge(l,f,n)}return r.compact(l)}},function(e,t){e.exports=require("url")},function(e,t,n){var r=n(12).Router(),o=n(4),a=n(3),i=n(31);let s=function(e){return!!o.existsSync(e)||(s(a.dirname(e))?(o.mkdirSync(e),!0):void 0)};var l=i.diskStorage({destination:function(e,t,n){s("upload/dabaImages/"),n(null,"upload/dabaImages/")},filename:function(e,t,n){n(null,t.originalname)}});s("./upload/");var u=i({storage:l});r.post("/",u.single("file"),(function(e,t,n){var r=e.file;console.log("文件保存路径：%s",r.path),t.json({data:r.path})})),e.exports=r},function(e,t,n){var r=n(12).Router(),o=n(4);n(31);r.post("/download",(function(e,t){console.log("---------访问下载路径-------------");o.exists("assets/small.docx",(function(e){e?(console.log("文件存在"),o.readFile("assets/small.docx","binary",(function(e,n){e?(t.writeHead(500,{"Content-Type":"text/plain"}),console.log("读取文件错误"),t.end(e)):(t.writeHead(200,{"Content-Type":"text/html"}),console.log("读取文件完毕，正在发送......"),t.write(n,"binary"),t.end(),console.log("文件发送完毕"))}))):(console.log("文件不存在"),t.writeHead(404,{"Content-Type":"text/plain"}),t.write("This request URL /small.docx was not found on this server."),t.end())}))})),e.exports=r},function(e,t,n){var r=n(75),o=n(84),a=n(88),i=n(32);function s(e,t,n){n(null,!0)}function l(e){e.storage?this.storage=e.storage:e.dest?this.storage=o({destination:e.dest}):this.storage=a(),this.limits=e.limits,this.preservePath=e.preservePath,this.fileFilter=e.fileFilter||s}l.prototype._makeMiddleware=function(e,t){return r(function(){var n=this.fileFilter,r=Object.create(null);return e.forEach((function(e){"number"==typeof e.maxCount?r[e.name]=e.maxCount:r[e.name]=1/0})),{limits:this.limits,preservePath:this.preservePath,storage:this.storage,fileFilter:function(e,t,o){if((r[t.fieldname]||0)<=0)return o(new i("LIMIT_UNEXPECTED_FILE",t.fieldname));r[t.fieldname]-=1,n(e,t,o)},fileStrategy:t}}.bind(this))},l.prototype.single=function(e){return this._makeMiddleware([{name:e,maxCount:1}],"VALUE")},l.prototype.array=function(e,t){return this._makeMiddleware([{name:e,maxCount:t}],"ARRAY")},l.prototype.fields=function(e){return this._makeMiddleware(e,"OBJECT")},l.prototype.none=function(){return this._makeMiddleware([],"NONE")},l.prototype.any=function(){return r(function(){return{limits:this.limits,preservePath:this.preservePath,storage:this.storage,fileFilter:this.fileFilter,fileStrategy:"ARRAY"}}.bind(this))},e.exports=function(e){if(void 0===e)return new l({});if("object"==typeof e&&null!==e)return new l(e);throw new TypeError("Expected object for argument options")},e.exports.diskStorage=o,e.exports.memoryStorage=a,e.exports.MulterError=i},function(e,t,n){var r=n(25),o=n(76),a=n(77),i=n(11),s=n(78),l=n(79),u=n(32),c=n(81),m=n(83);e.exports=function(e){return function(t,n,f){if(!r(t,["multipart"]))return f();var p,d=e(),h=d.limits,y=d.storage,g=d.fileFilter,v=d.fileStrategy,b=d.preservePath;t.body=Object.create(null);try{p=new o({headers:t.headers,limits:h,preservePath:b})}catch(e){return f(e)}var w=new c(v,t),x=!1,_=!1,E=!1,k=new l,q=[];function A(e){var n;x||(x=!0,t.unpipe(p),(n=t).on("readable",n.read.bind(n)),p.removeAllListeners(),i(t,(function(){f(e)})))}function N(){_&&k.isZero()&&!E&&A()}function $(e){E||(E=!0,k.onceZero((function(){m(q,(function(e,n){y._removeFile(t,e,n)}),(function(t,n){if(t)return A(t);e.storageErrors=n,A(e)}))})))}function T(e,t){$(new u(e,t))}p.on("field",(function(e,n,r,o){return r?T("LIMIT_FIELD_KEY"):o?T("LIMIT_FIELD_VALUE",e):h&&h.hasOwnProperty("fieldNameSize")&&e.length>h.fieldNameSize?T("LIMIT_FIELD_KEY"):void s(t.body,e,n)})),p.on("file",(function(e,n,r,o,i){if(!r)return n.resume();if(h&&h.hasOwnProperty("fieldNameSize")&&e.length>h.fieldNameSize)return T("LIMIT_FIELD_KEY");var s={fieldname:e,originalname:r,encoding:o,mimetype:i},l=w.insertPlaceholder(s);g(t,s,(function(r,o){if(r)return w.removePlaceholder(l),$(r);if(!o)return w.removePlaceholder(l),n.resume();var i=!1;k.increment(),Object.defineProperty(s,"stream",{configurable:!0,enumerable:!1,value:n}),n.on("error",(function(e){k.decrement(),$(e)})),n.on("limit",(function(){i=!0,T("LIMIT_FILE_SIZE",e)})),y._handleFile(t,s,(function(e,t){if(i)return w.removePlaceholder(l),q.push(a(s,t)),k.decrement();if(e)return w.removePlaceholder(l),k.decrement(),$(e);var n=a(s,t);w.replacePlaceholder(l,n),q.push(n),k.decrement(),N()}))}))})),p.on("error",(function(e){$(e)})),p.on("partsLimit",(function(){T("LIMIT_PART_COUNT")})),p.on("filesLimit",(function(){T("LIMIT_FILE_COUNT")})),p.on("fieldsLimit",(function(){T("LIMIT_FIELD_COUNT")})),p.on("finish",(function(){_=!0,N()})),t.pipe(p)}}},function(e,t){e.exports=require("busboy")},function(e,t){e.exports=require("xtend")},function(e,t){e.exports=require("append-field")},function(e,t,n){var r=n(15).EventEmitter;function o(){r.call(this),this.value=0}o.prototype=Object.create(r.prototype),o.prototype.increment=function(){this.value++},o.prototype.decrement=function(){0==--this.value&&this.emit("zero")},o.prototype.isZero=function(){return 0===this.value},o.prototype.onceZero=function(e){if(this.isZero())return e();this.once("zero",e)},e.exports=o},function(e,t){e.exports=require("util")},function(e,t,n){var r=n(82);function o(e,t){var n=e.indexOf(t);~n&&e.splice(n,1)}function a(e,t){switch(this.strategy=e,this.req=t,e){case"NONE":case"VALUE":break;case"ARRAY":t.files=[];break;case"OBJECT":t.files=Object.create(null);break;default:throw new Error("Unknown file strategy: "+e)}}a.prototype.insertPlaceholder=function(e){var t={fieldname:e.fieldname};switch(this.strategy){case"NONE":case"VALUE":break;case"ARRAY":this.req.files.push(t);break;case"OBJECT":this.req.files[e.fieldname]?this.req.files[e.fieldname].push(t):this.req.files[e.fieldname]=[t]}return t},a.prototype.removePlaceholder=function(e){switch(this.strategy){case"NONE":case"VALUE":break;case"ARRAY":o(this.req.files,e);break;case"OBJECT":1===this.req.files[e.fieldname].length?delete this.req.files[e.fieldname]:o(this.req.files[e.fieldname],e)}},a.prototype.replacePlaceholder=function(e,t){"VALUE"!==this.strategy?(delete e.fieldname,r(e,t)):this.req.file=t},e.exports=a},function(e,t){e.exports=require("object-assign")},function(e,t){e.exports=function(e,t,n){var r=e.length,o=[];if(0===r)return n(null,o);!function a(i){var s=e[i];t(s,(function(e){e&&(e.file=s,e.field=s.fieldname,o.push(e)),i<r-1?a(i+1):n(null,o)}))}(0)}},function(e,t,n){var r=n(4),o=n(85),a=n(3),i=n(86),s=n(87);function l(e,t,n){i.pseudoRandomBytes(16,(function(e,t){n(e,e?void 0:t.toString("hex"))}))}function u(e,t,n){n(null,o.tmpdir())}function c(e){this.getFilename=e.filename||l,"string"==typeof e.destination?(s.sync(e.destination),this.getDestination=function(t,n,r){r(null,e.destination)}):this.getDestination=e.destination||u}c.prototype._handleFile=function(e,t,n){var o=this;o.getDestination(e,t,(function(i,s){if(i)return n(i);o.getFilename(e,t,(function(e,o){if(e)return n(e);var i=a.join(s,o),l=r.createWriteStream(i);t.stream.pipe(l),l.on("error",n),l.on("finish",(function(){n(null,{destination:s,filename:o,path:i,size:l.bytesWritten})}))}))}))},c.prototype._removeFile=function(e,t,n){var o=t.path;delete t.destination,delete t.filename,delete t.path,r.unlink(o,n)},e.exports=function(e){return new c(e)}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("mkdirp")},function(e,t,n){var r=n(89);function o(e){}o.prototype._handleFile=function(e,t,n){t.stream.pipe(r({encoding:"buffer"},(function(e){n(null,{buffer:e,size:e.length})})))},o.prototype._removeFile=function(e,t,n){delete t.buffer,n(null)},e.exports=function(e){return new o(e)}},function(e,t){e.exports=require("concat-stream")},function(e,t,n){let r=n(91),o=n(95),a=n(100);e.exports=class{static initServer(e){return e.use("/subServer/kriging",r(e)),Promise.all([o.initAPI(e),a.initAPI(e)])}}},function(e,t,n){"use strict";const r=n(12),o=n(26),a=n(29);let i=n(33);const s=r.Router(),l=n(92),u=n(93),{createCanvas:c,loadImage:m}=n(94);let f=null;const p=n(4);let d=null,h={lmax:null,lmin:null,bmax:null,bmin:null},y=null,g=null,v=[{min:-1e3,max:-180,color:"#000000"},{min:-180,max:-170,color:"#FFFFFF"},{min:-170,max:-160,color:"#000000"},{min:-160,max:-150,color:"#FFFFFF"},{min:-150,max:-140,color:"#000000"},{min:-140,max:-130,color:"#FFFFFF"},{min:-130,max:-120,color:"#000000"},{min:-120,max:-110,color:"#FFFFFF"},{min:-110,max:-100,color:"#000000"},{min:-100,max:-90,color:"#FFFFFF"},{min:-90,max:-80,color:"#000000"},{min:-80,max:-70,color:"#FFFFFF"},{min:-70,max:-60,color:"#000000"},{min:-60,max:-50,color:"#FFFFFF"},{min:-50,max:-40,color:"#000000"},{min:-40,max:-30,color:"#FFFFFF"},{min:-30,max:-20,color:"#000000"},{min:-20,max:-10,color:"#FFFFFF"},{min:-10,max:0,color:"#000000"},{min:10,max:20,color:"#FFFFFF"},{min:20,max:30,color:"#000000"},{min:30,max:40,color:"#FFFFFF"},{min:40,max:50,color:"#000000"},{min:50,max:60,color:"#FFFFFF"},{min:60,max:70,color:"#000000"},{min:70,max:80,color:"#FFFFFF"},{min:80,max:90,color:"#000000"},{min:90,max:100,color:"#FFFFFF"},{min:100,max:1e3,color:"#000000"}];function b(e,t,n,r){w(t),null==f&&(f=c(2e3,2e3/(h.lmax-h.lmin)*(h.bmax-h.bmin))),d=f,y=f.getContext("2d");let o=n.length,a=[],i=[],s=[],u=[];for(let e=0;e<o;e++){let t=n[e].value;null!=t&&(a.push(t),i.push(n[e].x),s.push(n[e].y))}let m=l.train(a,i,s,"exponential",0,100),p=l.grid(t,m,r);return u=l.plot(d,p,[h.lmin,h.lmax],[h.bmin,h.bmax],e),u}function w(e){try{h.bmin=e[0][0][1],h.bmax=e[0][0][1],h.lmin=e[0][0][0],h.lmax=e[0][0][0];for(let t=0;t<e[0].length;t++){let n=e[0][t][0],r=e[0][t][1];r>h.bmax&&(h.bmax=r),n>h.lmax&&(h.lmax=n),r<h.bmin&&(h.bmin=r),n<h.lmin&&(h.lmin=n)}return h}catch(e){console.log(e)}}function x(e,t,n,r,o){try{let a=function(e){return{pfileName:"p"+e+".png",lfileName:"l"+e+".png",mfileName:"m"+e+".json"}}(e),s=a.pfileName,l=a.lfileName,c=a.mfileName,m=i.serverPath+"/static/krigingRatser/",y=m+s,g=m+l,w=m+c,x=null,E=null,k="test",q=null;return new Promise((function(e,a){p.exists(y,(function(a){a?(k=function(e){try{let t;return p.readFile(e,{encoding:"utf-8"},(function(e,n){e?console.log(e):t=n})),t}catch(e){console.log(e)}}(w),q=_(k),x=`api/static/krigingRatser/${s}`,E=`api/static/krigingRatser/${l}`):(k=function(e,t,n,r,o,a,i){try{let s=function(e){let t=[],n=e[0],r=e[1];for(let o=0;o<e.length;o+=3){let a=h.lmin+(e[o]-n)*(h.lmax-h.lmin)/2e3,i=h.bmin-(e[o+1]-r)*(h.bmax-h.bmin)/(2e3/(h.lmax-h.lmin)*(h.bmax-h.bmin));t.push(Math.floor(1e6*a)/1e6,Math.floor(1e6*i)/1e6,e[o+2])}return t}(b(function(e){try{let t=u.maps,n="";for(let r=0;r<t.length;r++)n=t[r].mapName==e?t[r].colors:[{min:-1e3,max:-50,color:"#ff0000"},{min:-50,max:-20,color:"#ffccff"},{min:-20,max:-10,color:"#ffcc00"},{min:-10,max:0,color:"#ffffcc"},{min:0,max:1e3,color:"#99ffff"}];return n}catch(e){console.log(e+"色带不匹配")}}(i),r,o,a));p.writeFile(n,s,"utf8",(function(e){e&&console.log(e)}));let l=d.toDataURL("image/png"),c=l.replace(/^data:image\/\w+;base64,/,""),m=Buffer.from(c,"base64");return p.writeFile(e,m,(function(e){e&&console.log(e)})),b(v,r,o,a),function(){let e=d.getContext("2d"),t=e.getImageData(0,0,d.width,d.height),n=t.data,r=t.width;for(let e=1;e<d.height;e++)for(let o=1;o<d.width;o++){let a=n[4*(e*r+o)],i=n[4*((e-1)*r+o-1)],s=n[4*((e-1)*r+o)],l=n[4*((e-1)*r+o+1)],u=n[4*(e*r+o-1)],c=n[4*(e*r+o+1)],m=n[4*((e+1)*r+o-1)],f=n[4*((e+1)*r+o)],p=n[4*((e+1)*r+o+1)];a==i&&a==s&&a==l&&a==u&&a==c&&a==m&&a==f&&a==p&&(t.data[4*(e*r+o)+3]=0)}for(let e=0;e<d.height;e++)for(let n=0;n<d.width;n++)255==t.data[4*(e*r+n)]&&0!=t.data[4*(e*r+n)+3]&&(t.data[4*(e*r+n)+3]=0),0!=e&&0!=n&&e!=d.height&&n!=d.width&&e!=d.height-1&&n!=d.width-1||(t.data[4*(e*r+n)+3]=0);for(let e=0;e<d.height;e++)for(let n=0;n<d.width;n++)0!=t.data[4*(e*r+n)+3]&&(t.data[4*(e*r+n)]=0,t.data[4*(e*r+n)+1]=0,t.data[4*(e*r+n)+2]=255,t.data[4*(e*r+n)+3]=255);e.putImageData(t,0,0)}(),f=null,l=d.toDataURL("image/png"),c=l.replace(/^data:image\/\w+;base64,/,""),m=Buffer.from(c,"base64"),p.writeFile(t,m,(function(e){e&&console.log(e)})),s}catch(e){console.log(e)}}(y,g,w,t,n,r,o),q=_(k),x=`api/static/krigingRatser/${s}`,E=`api/static/krigingRatser/${l}`),e([x,E,q,k])}))}))}catch(e){console.log(e)}}function _(e){let t=0,n=0,r=q(h.bmin,h.lmin,h.bmin,h.lmax)/2e3,o=q(h.bmin,h.lmin,h.bmax,h.lmin)/(2e3/d.width*d.height);try{for(let a=0;a<e.length;a+=3)if(e[a+2]<=0){n=r*o*(Math.floor(Math.abs(e[a+2])/1e3*100)/100),t+=n}return t=Math.floor(100*t)/100,t}catch(e){console.log(e)}}function E(e){try{return p.readFileSync(e,"utf-8")}catch(e){console.log(e)}}function k(e){try{let t=p.readFileSync(e,"utf-8");return JSON.parse(t)}catch(e){console.log(e)}}function q(e,t,n,r){try{let a=Math.PI,i=6378137;function o(e){return e*a/180}let s,l,u,c,m,f,p,d=o((e+n)/2),h=o((e-n)/2),y=o((t-r)/2),g=Math.sin(h),v=Math.sin(y),b=Math.sin(d),w=i,x=1/298.257;return g*=g,v*=v,b*=b,s=g*(1-v)+(1-b)*v,l=(1-g)*(1-v)+b*v,u=Math.atan(Math.sqrt(s/l)),c=Math.sqrt(s*l)/u,m=2*u*w,f=(3*c-1)/2/l,p=(3*c+1)/2/s,m*(1+x*(f*b*(1-g)-p*(1-b)*g))}catch(e){console.log(e)}}function A(e,t,n,r,o){try{let a=i.serverPath+"/static/data1/",s="";if(0==o)s=[[[t,n],[e,n],[e,r],[t,r],[t,n]]];else if("taiyuan"==o||"datong"==o||"yanhu"==o||"yaodu"==o){s=[k(a+o+".json")]}else console.log("区域选择失败！"),s="";return s}catch(e){console.log(e)}}e.exports=e=>(g=e,s.post("/creatRaster",(e,t)=>{try{let n=(new Date).getTime()+"url",r=e.body[0].val,s=e.body[1].val,l=e.body[2].val,u=e.body[3].val,c=e.body[4].val,m=e.body[5].val,f=e.body[6].val,p=e.body[7].val,d=e.body[8].val,h="sub_point",y="sub_value",g="seriaino",v=r,b=s,_=function(e,t,n,r,o){try{let a=i.serverPath+"/static/data/",s="";if(0==o)s=[[[t,n],[e,n],[e,r],[t,r],[t,n]]];else if("taiyuan"==o||"datong"==o||"yanhu"==o||"yaodu"==o){s=[E(a+o+".json")]}else console.log("区域选择失败！"),s="";return s}catch(e){console.log(e)}}(l,u,c,m,f);w(_);if(null==p)return void console.log("未指定差值步长···");if(v-b<0&&0==f){let e=`select name,x,y, sum(value) as value from ${h} join ${y} on ${h}.${g} = ${y}.${g} where ${l} >= sub_point.x and sub_point.x >= ${u} and ${c}>=sub_point.y and sub_point.y>=${m} and  sub_value.year>='${v}' and  sub_value.year<='${b}' group by name,x,y`;a.query(e,(function(e,r){let a=(e?o.createSuccess(500,e.message,r):o.createSuccess(200,"成功",r)).data.rows;if(0==a.length)return console.log("未查询到数据···"),void t.send("未查询到数据···");x(n,[[[u,c],[l,c],[l,m],[u,m],[u,c]]],a,p,d).then(([e,n,r,o])=>{t.send({purl:e,lurl:n,_volume:r,grid:o})})}))}else if(v-b==0&&0==f){let e=`select * from ${h} join ${y} on ${h}.${g} = ${y}.${g} where ${l} >= sub_point.x and sub_point.x >= ${u} and ${c}>=sub_point.y and sub_point.y>=${m} and  sub_value.year>='${v}' and  sub_value.year<='${b}'`;a.query(e,(function(e,r){let a=(e?o.createSuccess(500,e.message,r):o.createSuccess(200,"成功",r)).data.rows;if(0==a.length)return console.log("未查询到数据···"),void t.send("未查询到数据···");x(n,[[[u,c],[l,c],[l,m],[u,m],[u,c]]],a,p,d).then(([e,n,r,o])=>{t.send({purl:e,lurl:n,_volume:r,grid:o})})}))}else if(v-b<0&&0!=f){let e=`select name,x,y, sum(value) as value from ${h} join ${y} on ${h}.${g} = ${y}.${g} where  polygon '(${_})' @> point(sub_point.x,sub_point.y) and  sub_value.year>='${v}' and  sub_value.year<='${b}' group by name,x,y`;a.query(e,(function(e,r){let a=(e?o.createSuccess(500,e.message,r):o.createSuccess(200,"成功",r)).data.rows;if(0==a.length)return console.log("未查询到数据···"),void t.send("未查询到数据···");let i=A(l,u,c,m,f);x(n,i,a,p,d).then(([e,n,r,o])=>{t.send({purl:e,lurl:n,_volume:r,grid:o})})}))}else if(v-b==0&&0!=f){let e=`select name,x,y, sum(value) as value from ${h} join ${y} on ${h}.${g} = ${y}.${g} where  polygon '(${_})' @> point(sub_point.x,sub_point.y) and  sub_value.year>='${v}' and  sub_value.year<='${b}' group by name,x,y`;a.query(e,(function(e,r){let a=(e?o.createSuccess(500,e.message,r):o.createSuccess(200,"成功",r)).data.rows;if(0==a.length)return console.log("未查询到数据···"),void t.send("未查询到数据···");let i=A(l,u,c,m,f);x(n,i,a,p,d).then(([e,n,r,o])=>{t.send({purl:e,lurl:n,_volume:r,grid:o})})}))}}catch(e){console.log(`栅格提取失败:${e}`)}}),s)},function(e,t){Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var e,t;for(e=0,t=0;e<this.length;e++)t+=this[e];return t/this.length},Array.prototype.rep=function(e){for(var t=new Array(e),n=this[0],r=0;r<e;r++)t[r]=n;return t},Array.prototype.pip=function(e,t){var n,r,o=!1;for(n=0,r=this.length-1;n<this.length;r=n++)this[n][1]>t!=this[r][1]>t&&e<(this[r][0]-this[n][0])*(t-this[n][1])/(this[r][1]-this[n][1])+this[n][0]&&(o=!o);return o};var n=function(){var e={};return kriging_matrix_diag=function(e,t){var n,r=[0].rep(t*t);for(n=0;n<t;n++)r[n*t+n]=e;return r},kriging_matrix_transpose=function(e,t,n){var r,o,a=Array(n*t);for(r=0;r<t;r++)for(o=0;o<n;o++)a[o*t+r]=e[r*n+o];return a},kriging_matrix_scale=function(e,t,n,r){var o,a;for(o=0;o<n;o++)for(a=0;a<r;a++)e[o*r+a]*=t},kriging_matrix_add=function(e,t,n,r){var o,a,i=Array(n*r);for(o=0;o<n;o++)for(a=0;a<r;a++)i[o*r+a]=e[o*r+a]+t[o*r+a];return i},kriging_matrix_multiply=function(e,t,n,r,o){var a,i,s,l=Array(n*o);for(a=0;a<n;a++)for(i=0;i<o;i++)for(l[a*o+i]=0,s=0;s<r;s++)l[a*o+i]+=e[a*r+s]*t[s*o+i];return l},kriging_matrix_chol=function(e,t){var n,r,o,a=Array(t);for(n=0;n<t;n++)a[n]=e[n*t+n];for(n=0;n<t;n++){for(r=0;r<n;r++)a[n]-=e[n*t+r]*e[n*t+r];if(a[n]<=0)return!1;for(a[n]=Math.sqrt(a[n]),r=n+1;r<t;r++){for(o=0;o<n;o++)e[r*t+n]-=e[r*t+o]*e[n*t+o];e[r*t+n]/=a[n]}}for(n=0;n<t;n++)e[n*t+n]=a[n];return!0},kriging_matrix_chol2inv=function(e,t){var n,r,o,a;for(n=0;n<t;n++)for(e[n*t+n]=1/e[n*t+n],r=n+1;r<t;r++){for(a=0,o=n;o<r;o++)a-=e[r*t+o]*e[o*t+n];e[r*t+n]=a/e[r*t+r]}for(n=0;n<t;n++)for(r=n+1;r<t;r++)e[n*t+r]=0;for(n=0;n<t;n++){for(e[n*t+n]*=e[n*t+n],o=n+1;o<t;o++)e[n*t+n]+=e[o*t+n]*e[o*t+n];for(r=n+1;r<t;r++)for(o=r;o<t;o++)e[n*t+r]+=e[o*t+n]*e[o*t+r]}for(n=0;n<t;n++)for(r=0;r<n;r++)e[n*t+r]=e[r*t+n]},kriging_matrix_solve=function(e,t){var n,r,o,a,i,s,l,u,c,m,f,p=t,d=Array(t*t),h=Array(t),y=Array(t),g=Array(t);for(n=0;n<t;n++)for(a=0;a<t;a++)d[n*t+a]=n==a?1:0;for(a=0;a<t;a++)g[a]=0;for(n=0;n<t;n++){for(u=0,a=0;a<t;a++)if(1!=g[a])for(i=0;i<t;i++)0==g[i]&&Math.abs(e[a*t+i])>=u&&(u=Math.abs(e[a*t+i]),o=a,r=i);if(++g[r],o!=r){for(s=0;s<t;s++)f=e[o*t+s],e[o*t+s]=e[r*t+s],e[r*t+s]=f;for(s=0;s<p;s++)f=d[o*t+s],d[o*t+s]=d[r*t+s],d[r*t+s]=f}if(y[n]=o,h[n]=r,0==e[r*t+r])return!1;for(m=1/e[r*t+r],e[r*t+r]=1,s=0;s<t;s++)e[r*t+s]*=m;for(s=0;s<p;s++)d[r*t+s]*=m;for(l=0;l<t;l++)if(l!=r){for(c=e[l*t+r],e[l*t+r]=0,s=0;s<t;s++)e[l*t+s]-=e[r*t+s]*c;for(s=0;s<p;s++)d[l*t+s]-=d[r*t+s]*c}}for(s=t-1;s>=0;s--)if(y[s]!=h[s])for(i=0;i<t;i++)f=e[i*t+y[s]],e[i*t+y[s]]=e[i*t+h[s]],e[i*t+h[s]]=f;return!0},kriging_variogram_gaussian=function(e,t,n,r,o){return t+(r-t)/n*(1-Math.exp(-1/o*Math.pow(e/n,2)))},kriging_variogram_exponential=function(e,t,n,r,o){return t+(r-t)/n*(1-Math.exp(-1/o*(e/n)))},kriging_variogram_spherical=function(e,t,n,r,o){return e>n?t+(r-t)/n:t+(r-t)/n*(e/n*1.5-.5*Math.pow(e/n,3))},e.train=function(e,t,n,r,o,a){var i={t:e,x:t,y:n,nugget:0,range:0,sill:0,A:1/3,n:0};switch(r){case"gaussian":i.model=kriging_variogram_gaussian;break;case"exponential":i.model=kriging_variogram_exponential;break;case"spherical":i.model=kriging_variogram_spherical}var s,l,u,c,m=e.length,f=Array((m*m-m)/2);for(s=0,u=0;s<m;s++)for(l=0;l<s;l++,u++)f[u]=Array(2),f[u][0]=Math.pow(Math.pow(t[s]-t[l],2)+Math.pow(n[s]-n[l],2),.5),f[u][1]=Math.abs(e[s]-e[l]);f.sort((function(e,t){return e[0]-t[0]})),i.range=f[(m*m-m)/2-1][0];var p=(m*m-m)/2>30?30:(m*m-m)/2,d=i.range/p,h=[0].rep(p),y=[0].rep(p);if(p<30)for(c=0;c<p;c++)h[c]=f[c][0],y[c]=f[c][1];else{for(s=0,l=0,u=0,c=0;s<p&&l<(m*m-m)/2;s++,u=0){for(;f[l][0]<=(s+1)*d&&(h[c]+=f[l][0],y[c]+=f[l][1],u++,!(++l>=(m*m-m)/2)););u>0&&(h[c]/=u,y[c]/=u,c++)}if(c<2)return i}m=c,i.range=h[m-1]-h[0];var g=[1].rep(2*m),v=Array(m),b=i.A;for(s=0;s<m;s++){switch(r){case"gaussian":g[2*s+1]=1-Math.exp(-1/b*Math.pow(h[s]/i.range,2));break;case"exponential":g[2*s+1]=1-Math.exp(-1/b*h[s]/i.range);break;case"spherical":g[2*s+1]=h[s]/i.range*1.5-.5*Math.pow(h[s]/i.range,3)}v[s]=y[s]}var w=kriging_matrix_transpose(g,m,2),x=kriging_matrix_multiply(w,g,2,m,2),_=(x=kriging_matrix_add(x,kriging_matrix_diag(1/a,2),2,2)).slice(0);kriging_matrix_chol(x,2)?kriging_matrix_chol2inv(x,2):(kriging_matrix_solve(_,2),x=_);var E=kriging_matrix_multiply(kriging_matrix_multiply(x,w,2,2,m),v,2,m,1);i.nugget=E[0],i.sill=E[1]*i.range+i.nugget,i.n=t.length,m=t.length;var k=Array(m*m);for(s=0;s<m;s++){for(l=0;l<s;l++)k[s*m+l]=i.model(Math.pow(Math.pow(t[s]-t[l],2)+Math.pow(n[s]-n[l],2),.5),i.nugget,i.range,i.sill,i.A),k[l*m+s]=k[s*m+l];k[s*m+s]=i.model(0,i.nugget,i.range,i.sill,i.A)}var q=kriging_matrix_add(k,kriging_matrix_diag(o,m),m,m),A=q.slice(0);kriging_matrix_chol(q,m)?kriging_matrix_chol2inv(q,m):(kriging_matrix_solve(A,m),q=A);k=q.slice(0);var N=kriging_matrix_multiply(q,e,m,m,1);return i.K=k,i.M=N,i},e.predict=function(e,t,n){var r,o=Array(n.n);for(r=0;r<n.n;r++)o[r]=n.model(Math.pow(Math.pow(e-n.x[r],2)+Math.pow(t-n.y[r],2),.5),n.nugget,n.range,n.sill,n.A);return kriging_matrix_multiply(o,n.M,1,n.n,1)[0]},e.variance=function(e,t,n){var r,o=Array(n.n);for(r=0;r<n.n;r++)o[r]=n.model(Math.pow(Math.pow(e-n.x[r],2)+Math.pow(t-n.y[r],2),.5),n.nugget,n.range,n.sill,n.A);return n.model(0,n.nugget,n.range,n.sill,n.A)+kriging_matrix_multiply(kriging_matrix_multiply(o,n.K,1,n.n,n.n),o,1,n.n,1)[0]},e.grid=function(t,n,r){var o,a,i,s=t.length;if(0!=s){var l,u,c=[t[0][0][0],t[0][0][0]],m=[t[0][0][1],t[0][0][1]];for(o=0;o<s;o++)for(a=0;a<t[o].length;a++)t[o][a][0]<c[0]&&(c[0]=t[o][a][0]),t[o][a][0]>c[1]&&(c[1]=t[o][a][0]),t[o][a][1]<m[0]&&(m[0]=t[o][a][1]),t[o][a][1]>m[1]&&(m[1]=t[o][a][1]);var f=Array(2),p=Array(2),d=Array(2),h=Array(2),y=Math.ceil((c[1]-c[0])/r),g=Math.ceil((m[1]-m[0])/r),v=Array(y+1);for(o=0;o<=y;o++)v[o]=Array(g+1);for(o=0;o<s;o++){for(d[0]=t[o][0][0],d[1]=d[0],h[0]=t[o][0][1],h[1]=h[0],a=1;a<t[o].length;a++)t[o][a][0]<d[0]&&(d[0]=t[o][a][0]),t[o][a][0]>d[1]&&(d[1]=t[o][a][0]),t[o][a][1]<h[0]&&(h[0]=t[o][a][1]),t[o][a][1]>h[1]&&(h[1]=t[o][a][1]);for(f[0]=Math.floor((d[0]-(d[0]-c[0])%r-c[0])/r),f[1]=Math.ceil((d[1]-(d[1]-c[1])%r-c[0])/r),p[0]=Math.floor((h[0]-(h[0]-m[0])%r-m[0])/r),p[1]=Math.ceil((h[1]-(h[1]-m[1])%r-m[0])/r),a=f[0];a<=f[1];a++)for(i=p[0];i<=p[1];i++)l=c[0]+a*r,u=m[0]+i*r,t[o].pip(l,u)&&(v[a][i]=e.predict(l,u,n))}return v.xlim=c,v.ylim=m,v.zlim=[n.t.min(),n.t.max()],v.width=r,v}},e.getColor=function(e,t){for(var n=e.length,r=0;r<n;r++){if(3.1415==t)return"#00FF0000";if(t>=e[r].min&&t<e[r].max)return e[r].color}},e.plot=function(e,t,n,r,o){var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height);var i,s,l,u,c,m=[n[1]-n[0],r[1]-r[0],t.zlim[1]-t.zlim[0]],f=t.length,p=t[0].length,d=Math.ceil(t.width*e.width/(n[1]-n[0])),h=Math.ceil(t.width*e.height/(r[1]-r[0])),y=[];for(i=0;i<f;i++)for(s=0;s<p;s++)null==t[i][s]&&(t[i][s]=3.1415),l=e.width*(i*t.width+t.xlim[0]-n[0])/m[0],u=e.height*(1-(s*t.width+t.ylim[0]-r[0])/m[1]),c=t[i][s],a.fillStyle=this.getColor(o,c),a.fillRect(Math.round(l-d/2),Math.round(u-h/2),d,h),y.push(Math.round(l-d/2),Math.round(u-h/2),Math.round(100*c)/100);return y},e}();e.exports=n},function(e,t){e.exports={maps:[{mapName:"colorMap1",colors:[{min:-1e3,max:-50,color:"#ff0000"},{min:-50,max:-20,color:"#ffccff"},{min:-20,max:-10,color:"#ffcc00"},{min:-10,max:0,color:"#ffffcc"},{min:0,max:1e3,color:"#99ffff"}]},{mapName:"colorMap2",colors:[{min:-1e3,max:-200,color:"#2F4F4F"},{min:-200,max:-150,color:"#228B22"},{min:-150,max:-100,color:"#ADFF2F"},{min:-100,max:-50,color:"#7FFFAA"},{min:-50,max:1e3,color:"#F5FFFA"}]}]}},function(e,t){e.exports=require("canvas")},function(e,t,n){let r=n(96),o=n(13),a=n(99),i=null;const s="/UninphoServer/pg/baseAPI/";e.exports={initAPI:function(e){i=e,i.get(`${s}updatedb`,(function(e,t){o.updateDB().then(e=>{let n={};n=e.error?e:{message:"元数据表更新成功!"},t.send(n)})})),a.map(e=>{i.get(`${s}${e.name}`,(function(t,n){try{let o=t.query.tablename,a=t.query;r[e.name](o,a).then(e=>{n.send(e)})}catch(e){console.log(`数据获取错误:${e}`),n.send({error:!0,message:e})}})),i.post(`${s}${e.name}`,(function(t,n){try{let o,a=t.body.tablename;if(e.parms.length>1){let n=e.parms.filter(e=>"tablename"!=e.name)[0].name;o=t.body[n]}r[e.name](a,o).then(e=>{n.send(e)})}catch(e){console.log(`数据获取错误:${e}`),n.send({error:!0,message:e})}}))})}}},function(e,t,n){const r=n(34),o=n(13);e.exports=class{static list(e){let t=e,n=r.table2JSON(t);return o.doQuery(n).then(e=>r.doQueryCb(e))}static add(e,t){let n=Object.getOwnPropertyNames(t),a=n.map(e=>`'${t[e]}'`),i=r.table2JSONAdd(e,n.join(","),a.join(","));return o.doQuery(i).then(e=>r.doQueryCb(e))}static update(e,t){let n=Object.getOwnPropertyNames(t),a=`id=${t.id}`,i=n.map(e=>`${e}='${t[e]}'`).join(","),s=r.table2JSONupdate(e,i,a);return o.doQuery(s).then(e=>r.doQueryCb(e))}static remove(e,t){let n=r.table2JSONremove(e,"id",t.id);return o.doQuery(n).then(e=>r.doQueryCb(e))}static queryByKV(e,t){let[n,a]=[Object.getOwnPropertyNames(t)[1],t[Object.getOwnPropertyNames(t)[1]]],i=r.table2JSONqueryByKV(e,n,`'${a}'`,t.likeQuery);return o.doQuery(i).then(e=>r.doQueryCb(e))}static queryBySql(e,t){return o.doQuery(t.sql).then(e=>r.doQueryCb(e))}static queryByWhere(e,t){let n=r.table2JSONqueryByWhere(e,t);return o.doQuery(n).then(e=>r.doQueryCb(e))}}},function(e,t,n){var r=new(n(30).Client)("tcp://postgres:123456@localhost/dihuan");r.connect((function(e,t){if(e)return console.log("数据库连接失败: "+e.message),void r.end();console.log("场景数据库连接成功.\n")})),e.exports=r},function(e,t,n){const r=n(35);e.exports={getTablesDML:function(){return"\n       select  relname as tablename ,\n               col_description(c.oid, 0) as comment\t\t\n        from pg_class c \n        where  \n            relkind = 'r' and relname not like 'pg_%' and relname not like 'sql_%'"},getColumnsDML:function(e){return"\n    WITH RECURSIVE le as \n    (\n    select  relname as name ,\n        col_description(c.oid, 0) as comment,\n        relname as  type,\n        false as  notnull,\n        relname as tbname\n        from pg_class c \n    where  \n        relkind = 'r' and relname not like 'pg_%' and relname not like 'sql_%'\n     union all\n     select  \n        a.attname as name,\n        col_description(a.attrelid,a.attnum) as comment,\n        format_type(a.atttypid,a.atttypmod) as type,\t\n         a.attnotnull as notnull ,\n         t.name as tbname\n      FROM\n          pg_class as c,\n          pg_attribute as a ,\n          le as t\n    where c.relname = t.name and a.attrelid = c.oid and a.attnum>0\n     \n    )\n    select * from le where name<>tbname\n    "},metalTableDDL:function(){let e=r.metalTabel.name,t=r.metalTabel.fields,n=`id integer NOT NULL DEFAULT nextval('${e}_id_seq'::regclass)`,o="";return t.map(t=>{t.isKey||(n+=`,${t.name} ${t.type}`),o+=`;COMMENT ON COLUMN ${e}.${t.name} IS ' ${t.comment}'`}),`\n     BEGIN TRANSACTION;\n     --删除序列\n     DROP SEQUENCE IF EXISTS ${e}_id_seq ;       \n     --创建序列\n     CREATE SEQUENCE ${e}_id_seq;\n\n     DROP TABLE  IF EXISTS ${e};\n    CREATE TABLE ${e}\n    (\n        ${n},\n      CONSTRAINT ${e}_pkey PRIMARY KEY (id)\n    )\n    WITH (\n    OIDS=FALSE\n    );\n    ALTER TABLE ${e}\n    OWNER TO postgres;\n    COMMENT ON TABLE ${e} IS '表的字典表' \n    ${o};\n \n    COMMIT;\n    `},metalColumnDDL:function(){let e=r.metalTabel.name,t=r.metalColumn.name,n=r.metalColumn.fields,o=`id integer NOT NULL DEFAULT nextval('${t}_id_seq'::regclass),`,a="";return n.map(e=>{e.isKey||(o+=`${e.name} ${e.type},`),a+=`;COMMENT ON COLUMN ${t}.${e.name} IS '${e.comment}'`}),`\n     BEGIN TRANSACTION;\n     --删除序列\n     DROP SEQUENCE IF EXISTS ${t}_id_seq;        \n     --创建序列\n     CREATE SEQUENCE ${t}_id_seq\n     INCREMENT 1\n     START 1\n     MINVALUE 1\n     MAXVALUE 99999999\n     CACHE 1; \n     ALTER SEQUENCE ${t}_id_seq\n     OWNER TO postgres;\n     --删除表\n     DROP TABLE  IF EXISTS ${t};\n     --创建表\n    CREATE TABLE ${t}\n    (\n       ${o}\n        CONSTRAINT ${t}_pkey PRIMARY KEY (id),\n        CONSTRAINT ${t}_tableid_fkey FOREIGN KEY (tableid)\n            REFERENCES ${e} (id) MATCH SIMPLE\n            ON UPDATE CASCADE ON DELETE CASCADE\n    )\n    WITH (\n     OIDS=FALSE\n    );\n    ALTER TABLE ${t}\n    OWNER TO postgres;\n    COMMENT ON TABLE ${t} IS '字段_表'\n    ${a};\n    \n    COMMIT;\n    \n    `}}},function(e,t){e.exports=[{name:"list",text:"获取列表",requestType:"get",parms:[{name:"tablename",type:"string",desc:"表的名称"}],desc:"列出表中的所有记录"},{name:"add",text:"添加",requestType:"post",parms:[{name:"tablename",type:"string",desc:"表的名称"},{name:"data",type:"Object",desc:"添加的数据row一行"}],desc:"添加一条记录"},{name:"remove",text:"删除",requestType:"post",parms:[{name:"tablename",type:"string",desc:"表的名称"},{name:"data",type:"Object",desc:"根据主键id删除"}],desc:"删除一条记录"},{name:"update",text:"修改",requestType:"post",parms:[{name:"tablename",type:"string",desc:"表的名称"},{name:"data",type:"Object",desc:"修改的数据"}],desc:"更新一条记录"},{name:"queryByKV",requestType:"all",text:"查询",parms:[{name:"tablename",type:"string",desc:"表的名称"},{name:"data",type:"string",desc:"键/值"}],desc:"根据键/值查询"},{name:"queryBySql",text:"查询",requestType:"all",parms:[{name:"sql",type:"string",desc:"查询的SQl语句"}],desc:"根据sql 语句查询"},{name:"queryByWhere",text:"查询",requestType:"all",parms:[{name:"tablename",type:"string",desc:"表的名称"},{name:"whereClause",type:"string",desc:"查询的条件"}],desc:"根据sql 条件查询记录，如 'name = xxx and id = xxx and name like %zhan%'"}]},function(e,t,n){const r=n(101);let o=null;const a="/UninphoServer/pg/customAPI/",i=[{name:"test",text:"获取列表",requestType:"get",parms:[{name:"tablename",type:"string",desc:"表的名称"}],desc:"列出表中的所有记录"}];e.exports={initAPI:function(e){o=e,i.map(e=>{o.get(`${a}${e.name}`,(function(t,n){try{let t=r[e.name]();n.send(t)}catch(e){console.log(`数据获取错误:${e}`)}})),o.post(`${a}${e.name}`,(function(t,n){try{let t=r[e.name]();n.send(t)}catch(e){console.log(`数据获取错误:${e}`)}}))}),o.get(`${a}serverMethods`,(function(e,t){t.send(i)}))}}},function(e,t,n){n(34),n(13);e.exports={test:function(e,t){return{message:"服务测试成功!"}}}}]);